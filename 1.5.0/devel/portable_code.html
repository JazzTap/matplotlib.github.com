<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Writing code for Python 2 and 3 — Matplotlib 1.5.0 documentation</title>
<link href="../_static/mpl.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<link href="../_static/opensearch.xml" rel="search" title="Search within Matplotlib 1.5.0 documentation" type="application/opensearchdescription+xml"/>
<link href="../index.html" rel="top" title="Matplotlib 1.5.0 documentation"/>
<link href="index.html" rel="up" title="The Matplotlib Developers’ Guide"/>
<link href="license.html" rel="next" title="Licenses"/>
<link href="coding_guide.html" rel="prev" title="Coding guide"/>
<link href="http://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css"/>
<link href="https://matplotlib.org/devel/portable_code.html" rel="canonical"/></head>
<body><div id="old-version-banner">
            You are reading documentation for a static version of Matplotlib.
            <a href="https://matplotlib.org/devel/portable_code.html">This page may have been updated.</a>
</div>
<div class="alert" style="background-color: #FEA46C; padding: 10px 0;
">
<h3>We're updating the default styles for Matplotlib 2.0</h3>
<p>Learn what to expect in the <a href="/style_changes.html" style="font-weight: bold;
color: #11557C;">new updates</a></p>
</div>
<link href="/_static/favicon.ico" rel="shortcut icon"/>
<!-- The "Fork me on github" ribbon -->
<img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" style="float: right; margin-bottom: -40px; top: 0; right: 0; border: 0;" usemap="#ribbonmap"/>
<map name="ribbonmap">
<area coords="15,0,148,-1,148,135" href="https://github.com/matplotlib/matplotlib" shape="poly" title="Fork me on GitHub"/>
</map>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img alt="matplotlib" border="0" src="../_static/logo2.png"/></a>
</div>
<div class="related">
<h3>Navigation</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../genindex.html" title="General Index">index</a></li>
<li class="right">
<a href="../py-modindex.html" title="Python Module Index">modules</a> |</li>
<li class="right">
<a accesskey="N" href="license.html" title="Licenses">next</a> |</li>
<li class="right">
<a accesskey="P" href="coding_guide.html" title="Coding guide">previous</a> |</li>
<li><a href="../index.html">home</a>| </li>
<li><a href="../examples/index.html">examples</a>| </li>
<li><a href="../gallery.html">gallery</a>| </li>
<li><a href="../api/pyplot_summary.html">pyplot</a>| </li>
<li><a href="../contents.html">docs</a> »</li>
<li><a accesskey="U" href="index.html">The Matplotlib Developers’ Guide</a> »</li>
</ul>
</div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><a href="../contents.html">Table Of Contents</a></h3>
<ul>
<li><a class="reference internal" href="#">Writing code for Python 2 and 3</a><ul>
<li><a class="reference internal" href="#welcome-to-the-future">Welcome to the <code class="docutils literal"><span class="pre">__future__</span></code></a></li>
<li><a class="reference internal" href="#finding-places-to-use-six">Finding places to use six</a></li>
<li><a class="reference internal" href="#the-dreaded-u-escapes">The dreaded <code class="docutils literal"><span class="pre">\u</span></code> escapes</a></li>
<li><a class="reference internal" href="#iteration">Iteration</a></li>
<li><a class="reference internal" href="#numpy-specific-things">Numpy-specific things</a></li>
</ul>
</li>
</ul>
<h4>Previous topic</h4>
<p class="topless"><a href="coding_guide.html" title="previous chapter">Coding guide</a></p>
<h4>Next topic</h4>
<p class="topless"><a href="license.html" title="next chapter">Licenses</a></p>
<div aria-label="source link" role="note">
<h3>This Page</h3>
<ul class="this-page-menu">
<li><a href="../_sources/devel/portable_code.txt" rel="nofollow">Show Source</a></li>
</ul>
</div>
<div id="searchbox" role="search" style="display: none">
<h3>Quick search</h3>
<form action="../search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body">
<div class="section" id="writing-code-for-python-2-and-3">
<h1>Writing code for Python 2 and 3<a class="headerlink" href="#writing-code-for-python-2-and-3" title="Permalink to this headline">¶</a></h1>
<p>As of matplotlib 1.4, the <a class="reference external" href="http://pythonhosted.org/six/">six</a>
library is used to support Python 2 and 3 from a single code base.
The <code class="xref py py-obj docutils literal"><span class="pre">2to3</span></code> tool is no longer used.</p>
<p>This document describes some of the issues with that approach and some
recommended solutions.  It is not a complete guide to Python 2 and 3
compatibility.</p>
<div class="section" id="welcome-to-the-future">
<h2>Welcome to the <code class="docutils literal"><span class="pre">__future__</span></code><a class="headerlink" href="#welcome-to-the-future" title="Permalink to this headline">¶</a></h2>
<p>The top of every <code class="xref py py-obj docutils literal"><span class="pre">py</span></code> file should include the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span>
                        <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">six</span>
</pre></div>
</div>
<p>This will make the Python 2 interpreter behave as close to Python 3 as
possible.</p>
<p>All matplotlib files should also import <code class="xref py py-obj docutils literal"><span class="pre">six</span></code>, whether they are using
it or not, just to make moving code between modules easier, as <code class="xref py py-obj docutils literal"><span class="pre">six</span></code>
gets used <em>a lot</em>.</p>
</div>
<div class="section" id="finding-places-to-use-six">
<h2>Finding places to use six<a class="headerlink" href="#finding-places-to-use-six" title="Permalink to this headline">¶</a></h2>
<p>The only way to make sure code works on both Python 2 and 3 is to make sure it
is covered by unit tests.</p>
<p>However, the <code class="xref py py-obj docutils literal"><span class="pre">2to3</span></code> commandline tool can also be used to locate places
that require special handling with <code class="xref py py-obj docutils literal"><span class="pre">six</span></code>.</p>
<p>(The <a class="reference external" href="https://pypi.python.org/pypi/modernize">modernize</a> tool may
also be handy, though I’ve never used it personally).</p>
<p>The <a class="reference external" href="http://pythonhosted.org/six/">six</a> documentation serves as a
good reference for the sorts of things that need to be updated.</p>
</div>
<div class="section" id="the-dreaded-u-escapes">
<h2>The dreaded <code class="docutils literal"><span class="pre">\u</span></code> escapes<a class="headerlink" href="#the-dreaded-u-escapes" title="Permalink to this headline">¶</a></h2>
<p>When <code class="xref py py-obj docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code> is used, all string
literals (not preceded with a <code class="xref py py-obj docutils literal"><span class="pre">b</span></code>) will become unicode literals.</p>
<p>Normally, one would use “raw” string literals to encode strings that
contain a lot of slashes that we don’t want Python to interpret as
special characters.  A common example in matplotlib is when it deals
with TeX and has to represent things like <code class="docutils literal"><span class="pre">r"\usepackage{foo}"</span></code>.
Unfortunately, on Python 2there is no way to represent <code class="xref py py-obj docutils literal"><span class="pre">u</span></code> in a raw
unicode string literal, since it will always be interpreted as the
start of a unicode character escape, such as <code class="xref py py-obj docutils literal"><span class="pre">u20af</span></code>.  The only
solution is to use a regular (non-raw) string literal and repeat all
slashes, e.g. <code class="docutils literal"><span class="pre">"\\usepackage{foo}"</span></code>.</p>
<p>The following shows the problem on Python 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">ur'\u'</span>
  File <span class="nb">"&lt;stdin&gt;"</span>, line <span class="m">1</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) 'rawunicodeescape' codec can't decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">ur'</span><span class="se">\\</span><span class="s">u'</span>
<span class="go">u'\\\\u'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">u'\u'</span>
  File <span class="nb">"&lt;stdin&gt;"</span>, line <span class="m">1</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) 'unicodeescape' codec can't decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX escape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">u'</span><span class="se">\\</span><span class="s">u'</span>
<span class="go">u'\\u'</span>
</pre></div>
</div>
<p>This bug has been fixed in Python 3, however, we can’t take advantage
of that and still support Python 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">r'\u'</span>
<span class="go">'\\u'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">r'</span><span class="se">\\</span><span class="s">u'</span>
<span class="go">'\\\\u'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">'\u'</span>
  File <span class="nb">"&lt;stdin&gt;"</span>, line <span class="m">1</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) 'unicodeescape' codec can't decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX escape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">'</span><span class="se">\\</span><span class="s">u'</span>
<span class="go">'\\u'</span>
</pre></div>
</div>
</div>
<div class="section" id="iteration">
<h2>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h2>
<p>The behavior of the methods for iterating over the items, values and
keys of a dictionary has changed in Python 3.  Additionally, other
built-in functions such as <code class="xref py py-obj docutils literal"><span class="pre">zip</span></code>, <code class="xref py py-obj docutils literal"><span class="pre">range</span></code> and <code class="xref py py-obj docutils literal"><span class="pre">map</span></code> have changed to
return iterators rather than temporary lists.</p>
<p>In many cases, the performance implications of iterating vs. creating
a temporary list won’t matter, so it’s tempting to use the form that
is simplest to read.  However, that results in code that behaves
differently on Python 2 and 3, leading to subtle bugs that may not be
detected by the regression tests.  Therefore, unless the loop in
question is provably simple and doesn’t call into other code, the
<code class="xref py py-obj docutils literal"><span class="pre">six</span></code> versions that ensure the same behavior on both Python 2 and 3
should be used.  The following table shows the mapping of equivalent
semantics between Python 2, 3 and six for <code class="xref py py-obj docutils literal"><span class="pre">dict.items()</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%"/>
<col width="33%"/>
<col width="33%"/>
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Python 2</th>
<th class="head">Python 3</th>
<th class="head">six</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">d.items()</span></code></td>
<td><code class="docutils literal"><span class="pre">list(d.items())</span></code></td>
<td><code class="docutils literal"><span class="pre">list(six.iteritems(d))</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">d.iteritems()</span></code></td>
<td><code class="docutils literal"><span class="pre">d.items()</span></code></td>
<td><code class="docutils literal"><span class="pre">six.iteritems(d)</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="numpy-specific-things">
<h2>Numpy-specific things<a class="headerlink" href="#numpy-specific-things" title="Permalink to this headline">¶</a></h2>
<p>When specifying dtypes, all strings must be byte strings on Python 2
and unicode strings on Python 3.  The best way to handle this is to
force cast them using <code class="xref py py-obj docutils literal"><span class="pre">str()</span></code>.  The same is true of structure
specifiers in the <code class="xref py py-obj docutils literal"><span class="pre">struct</span></code> built-in module.</p>
</div>
</div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div class="footer">
        © Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the matplotlib development team; 2012 - 2014 The matplotlib development team.
      Last updated on Oct 29, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55954603-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
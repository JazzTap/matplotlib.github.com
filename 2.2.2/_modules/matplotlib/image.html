<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>matplotlib.image — Matplotlib 2.2.2 documentation</title>
<link href="../../_static/mpl.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/gallery.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../_static/opensearch.xml" rel="search" title="Search within Matplotlib 2.2.2 documentation" type="application/opensearchdescription+xml"/>
<link href="../../_static/favicon.ico" rel="shortcut icon"/>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../../index.html" rel="top" title="Matplotlib 2.2.2 documentation"/>
<link href="../matplotlib.html" rel="up" title="matplotlib"/>
<link href="https://matplotlib.org/_modules/matplotlib/image.html" rel="canonical"/>
<link href="https://matplotlib.org/_modules/matplotlib/image.html" rel="canonical"/></head>
<body><div id="old-version-banner">
            You are reading documentation for a static version of Matplotlib.
            <a href="https://matplotlib.org/_modules/matplotlib/image.html">This page may have been updated.</a>
</div>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
<a href="../../index.html">
<div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 2.2.2</span></div>
<img alt="matplotlib" border="0" height="125px" src="../../_static/logo2.png"/></a>
<!-- The "Fork me on github" ribbon -->
<div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
</div>
<div class="related">
<h3>Navigation</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../../genindex.html" title="General Index">index</a></li>
<li class="right">
<a href="../../py-modindex.html" title="Python Module Index">modules</a> |</li>
<li><a href="../../index.html">home</a>| </li>
<li><a href="../../gallery/index.html">examples</a>| </li>
<li><a href="../../tutorials/index.html">tutorials</a>| </li>
<li><a href="../../api/pyplot_summary.html">pyplot</a>| </li>
<li><a href="../../contents.html">docs</a> »</li>
<li><a href="../index.html">Module code</a> »</li>
<li><a accesskey="U" href="../matplotlib.html">matplotlib</a> »</li>
</ul>
</div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<div id="searchbox" role="search" style="display: none">
<h3>Quick search</h3>
<div class="searchformwrapper">
<form action="../../search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
<li><a href="../../contents.html">Documentation overview</a><ul>
<li><a href="../index.html">Module code</a><ul>
<li><a href="../matplotlib.html">matplotlib</a><ul>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body">
<h1>Source code for matplotlib.image</h1><div class="highlight"><pre>
<span></span><span class="sd">"""</span>
<span class="sd">The image module supports basic image loading, rescaling and display</span>
<span class="sd">operations.</span>

<span class="sd">"""</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.request</span> <span class="k">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">ceil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="kn">import</span> <span class="nn">matplotlib.artist</span> <span class="k">as</span> <span class="nn">martist</span>
<span class="kn">from</span> <span class="nn">matplotlib.artist</span> <span class="k">import</span> <span class="n">allow_rasterization</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.cbook</span> <span class="k">as</span> <span class="nn">cbook</span>

<span class="c1"># For clarity, names from _image are given explicitly in this module:</span>
<span class="kn">import</span> <span class="nn">matplotlib._image</span> <span class="k">as</span> <span class="nn">_image</span>
<span class="kn">import</span> <span class="nn">matplotlib._png</span> <span class="k">as</span> <span class="nn">_png</span>

<span class="c1"># For user convenience, the names from _image are also imported into</span>
<span class="c1"># the image namespace:</span>
<span class="kn">from</span> <span class="nn">matplotlib._image</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="k">import</span> <span class="p">(</span><span class="n">Affine2D</span><span class="p">,</span> <span class="n">BboxBase</span><span class="p">,</span> <span class="n">Bbox</span><span class="p">,</span> <span class="n">BboxTransform</span><span class="p">,</span>
                                   <span class="n">IdentityTransform</span><span class="p">,</span> <span class="n">TransformedBbox</span><span class="p">)</span>

<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># map interpolation strings to module constants</span>
<span class="n">_interpd_</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'none'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>  <span class="c1"># fall back to nearest when not supported</span>
    <span class="s1">'nearest'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
    <span class="s1">'bilinear'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">,</span>
    <span class="s1">'bicubic'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">BICUBIC</span><span class="p">,</span>
    <span class="s1">'spline16'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">SPLINE16</span><span class="p">,</span>
    <span class="s1">'spline36'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">SPLINE36</span><span class="p">,</span>
    <span class="s1">'hanning'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">HANNING</span><span class="p">,</span>
    <span class="s1">'hamming'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">HAMMING</span><span class="p">,</span>
    <span class="s1">'hermite'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">HERMITE</span><span class="p">,</span>
    <span class="s1">'kaiser'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">KAISER</span><span class="p">,</span>
    <span class="s1">'quadric'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">QUADRIC</span><span class="p">,</span>
    <span class="s1">'catrom'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">CATROM</span><span class="p">,</span>
    <span class="s1">'gaussian'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">GAUSSIAN</span><span class="p">,</span>
    <span class="s1">'bessel'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">BESSEL</span><span class="p">,</span>
    <span class="s1">'mitchell'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">MITCHELL</span><span class="p">,</span>
    <span class="s1">'sinc'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">SINC</span><span class="p">,</span>
    <span class="s1">'lanczos'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">,</span>
    <span class="s1">'blackman'</span><span class="p">:</span> <span class="n">_image</span><span class="o">.</span><span class="n">BLACKMAN</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">interpolations_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_interpd_</span><span class="p">)</span>


<div class="viewcode-block" id="composite_images"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.composite_images">[docs]</a><span class="k">def</span> <span class="nf">composite_images</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Composite a number of RGBA images into one.  The images are</span>
<span class="sd">    composited in the order in which they appear in the `images` list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    images : list of Images</span>
<span class="sd">        Each must have a `make_image` method.  For each image,</span>
<span class="sd">        `can_composite` should return `True`, though this is not</span>
<span class="sd">        enforced by this function.  Each image must have a purely</span>
<span class="sd">        affine transformation with no shear.</span>

<span class="sd">    renderer : RendererBase instance</span>

<span class="sd">    magnification : float</span>
<span class="sd">        The additional magnification to apply for the renderer in use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple : image, offset_x, offset_y</span>
<span class="sd">        Returns the tuple:</span>

<span class="sd">        - image: A numpy array of the same type as the input images.</span>

<span class="sd">        - offset_x, offset_y: The offset of the image (left, bottom)</span>
<span class="sd">          in the output figure.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">trans</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">make_image</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">*=</span> <span class="n">magnification</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="n">magnification</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Bbox</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
        <span class="n">_image</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">_image</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
                        <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">x0</span> <span class="o">/</span> <span class="n">magnification</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y0</span> <span class="o">/</span> <span class="n">magnification</span></div>


<span class="k">def</span> <span class="nf">_draw_list_compositing_images</span><span class="p">(</span>
        <span class="n">renderer</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="n">suppress_composite</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Draw a sorted list of artists, compositing images into a single</span>
<span class="sd">    image where possible.</span>

<span class="sd">    For internal matplotlib use only: It is here to reduce duplication</span>
<span class="sd">    between `Figure.draw` and `Axes.draw`, but otherwise should not be</span>
<span class="sd">    generally useful.</span>
<span class="sd">    """</span>
    <span class="n">has_images</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_ImageBase</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">)</span>

    <span class="c1"># override the renderer default if suppressComposite is not None</span>
    <span class="n">not_composite</span> <span class="o">=</span> <span class="p">(</span><span class="n">suppress_composite</span> <span class="k">if</span> <span class="n">suppress_composite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                     <span class="k">else</span> <span class="n">renderer</span><span class="o">.</span><span class="n">option_image_nocomposite</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Composite any adjacent images together</span>
        <span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">get_image_magnification</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">flush_images</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">image_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">composite_images</span><span class="p">(</span><span class="n">image_group</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">mag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gc</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>
                    <span class="n">gc</span><span class="o">.</span><span class="n">set_clip_rectangle</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
                    <span class="n">gc</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">get_clip_path</span><span class="p">())</span>
                    <span class="n">renderer</span><span class="o">.</span><span class="n">draw_image</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">gc</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">image_group</span><span class="p">[:]</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ImageBase</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">can_composite</span><span class="p">():</span>
                <span class="n">image_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flush_images</span><span class="p">()</span>
                <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">flush_images</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_rgb_to_rgba</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Convert an RGB image to RGBA, as required by the image resample C++</span>
<span class="sd">    extension.</span>
<span class="sd">    """</span>
    <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">rgba</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
    <span class="k">if</span> <span class="n">rgba</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
        <span class="n">rgba</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rgba</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">rgba</span>


<span class="k">class</span> <span class="nc">_ImageBase</span><span class="p">(</span><span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">):</span>
    <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">"2.1"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_interpd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_interpd_</span>

    <span class="nd">@property</span>
    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">"2.1"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_interpdr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">_interpd_</span><span class="p">)}</span>

    <span class="nd">@property</span>
    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">"2.1"</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">"mpl.image.interpolation_names"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">iterpnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">interpolations_names</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"AxesImage(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">;</span><span class="si">%g</span><span class="s2">x</span><span class="si">%g</span><span class="s2">)"</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">filternorm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">filterrad</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                 <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        interpolation and cmap default to their rc settings</span>

<span class="sd">        cmap is a colors.Colormap instance</span>
<span class="sd">        norm is a colors.Normalize instance to map luminance to 0-1</span>

<span class="sd">        extent is data axes (left, right, bottom, top) for making image plots</span>
<span class="sd">        registered with data plots.  Default is to label the pixel</span>
<span class="sd">        centers with the zero-based row and column indices.</span>

<span class="sd">        Additional kwargs are matplotlib.artist properties</span>

<span class="sd">        """</span>
        <span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mouseover</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'image.origin'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_filternorm</span><span class="p">(</span><span class="n">filternorm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_filterrad</span><span class="p">(</span><span class="n">filterrad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_interpolation</span><span class="p">(</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_resample</span><span class="p">(</span><span class="n">resample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">_ImageBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
        <span class="c1"># We can't pickle the C Image cached object.</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">'_imcache'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Get the numrows, numcols of the input image"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'You must first set the image array'</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the alpha value used for blending - not supported on</span>
<span class="sd">        all backends</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        """</span>
        <span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Call this whenever the mappable is changed so observers can</span>
<span class="sd">        update state</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">in_bbox</span><span class="p">,</span> <span class="n">out_bbox</span><span class="p">,</span> <span class="n">clip_bbox</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">round_to_pixel_border</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Normalize, rescale and color the image `A` from the given</span>
<span class="sd">        in_bbox (in data space), to the given out_bbox (in pixel</span>
<span class="sd">        space) clipped to the given clip_bbox (also in pixel space),</span>
<span class="sd">        and magnified by the magnification factor.</span>

<span class="sd">        `A` may be a greyscale image (MxN) with a dtype of `float32`,</span>
<span class="sd">        `float64`, `uint16` or `uint8`, or an RGBA image (MxNx4) with</span>
<span class="sd">        a dtype of `float32`, `float64`, or `uint8`.</span>

<span class="sd">        If `unsampled` is True, the image will not be scaled, but an</span>
<span class="sd">        appropriate affine transformation will be returned instead.</span>

<span class="sd">        If `round_to_pixel_border` is True, the output image size will</span>
<span class="sd">        be rounded to the nearest pixel boundary.  This makes the</span>
<span class="sd">        images align correctly with the axes.  It should not be used</span>
<span class="sd">        in cases where you want exact scaling, however, such as</span>
<span class="sd">        FigureImage.</span>

<span class="sd">        Returns the resulting (image, x, y, trans), where (x, y) is</span>
<span class="sd">        the upper left corner of the result in pixel space, and</span>
<span class="sd">        `trans` is the affine transformation from the image to pixel</span>
<span class="sd">        space.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'You must first set the image '</span>
                               <span class="s1">'array or the image attribute'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"_make_image must get a non-empty image. "</span>
                               <span class="s2">"Your Artist's draw method must filter before "</span>
                               <span class="s2">"this method is called."</span><span class="p">)</span>

        <span class="n">clipped_bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">out_bbox</span><span class="p">,</span> <span class="n">clip_bbox</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clipped_bbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">out_width_base</span> <span class="o">=</span> <span class="n">clipped_bbox</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">magnification</span>
        <span class="n">out_height_base</span> <span class="o">=</span> <span class="n">clipped_bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">magnification</span>

        <span class="k">if</span> <span class="n">out_width_base</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">out_height_base</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s1">'upper'</span><span class="p">:</span>
            <span class="c1"># Flip the input image using a transform.  This avoids the</span>
            <span class="c1"># problem with flipping the array, which results in a copy</span>
            <span class="c1"># when it is converted to contiguous in the C wrapper</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">IdentityTransform</span><span class="p">()</span>

        <span class="n">t0</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">Affine2D</span><span class="p">()</span>
            <span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">in_bbox</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">in_bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">in_bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">in_bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">())</span>

        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span>
             <span class="o">+</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
                 <span class="o">-</span><span class="n">clipped_bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span>
                 <span class="o">-</span><span class="n">clipped_bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
             <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">magnification</span><span class="p">,</span> <span class="n">magnification</span><span class="p">))</span>

        <span class="c1"># So that the image is aligned with the edge of the axes, we want</span>
        <span class="c1"># to round up the output width to the next integer.  This also</span>
        <span class="c1"># means scaling the transform just slightly to account for the</span>
        <span class="c1"># extra subpixel.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">is_affine</span> <span class="ow">and</span> <span class="n">round_to_pixel_border</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">out_width_base</span> <span class="o">%</span> <span class="mf">1.0</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">out_height_base</span> <span class="o">%</span> <span class="mf">1.0</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)):</span>
            <span class="n">out_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">out_width_base</span><span class="p">))</span>
            <span class="n">out_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">out_height_base</span><span class="p">))</span>
            <span class="n">extra_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">out_width</span> <span class="o">-</span> <span class="n">out_width_base</span><span class="p">)</span> <span class="o">/</span> <span class="n">out_width_base</span>
            <span class="n">extra_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">out_height</span> <span class="o">-</span> <span class="n">out_height_base</span><span class="p">)</span> <span class="o">/</span> <span class="n">out_height_base</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">extra_width</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">extra_height</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out_width_base</span><span class="p">)</span>
            <span class="n">out_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">out_height_base</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unsampled</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid dimensions, got </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># if we are a 2D array, then we are running through the</span>
                <span class="c1"># norm + colormap transformation.  However, in general the</span>
                <span class="c1"># input data is not going to match the size on the screen so we</span>
                <span class="c1"># have to resample to the correct number of pixels</span>
                <span class="c1"># need to</span>

                <span class="c1"># TODO slice input array first</span>
                <span class="n">inp_dtype</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span>
                <span class="n">a_min</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">a_max</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="c1"># figure out the type we should scale to.  For floats,</span>
                <span class="c1"># leave as is.  For integers cast to an appropriate-sized</span>
                <span class="c1"># float.  Small integers get smaller floats in an attempt</span>
                <span class="c1"># to keep the memory footprint reasonable.</span>
                <span class="k">if</span> <span class="n">a_min</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span><span class="p">:</span>
                    <span class="c1"># all masked, so values don't matter</span>
                    <span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inp_dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">'f'</span><span class="p">:</span>
                    <span class="n">scaled_dtype</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># probably an integer of some type.</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">a_max</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">-</span> <span class="n">a_min</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">da</span> <span class="o">&gt;</span> <span class="mf">1e8</span><span class="p">:</span>
                        <span class="c1"># give more breathing room if a big dynamic range</span>
                        <span class="n">scaled_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scaled_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

                <span class="c1"># scale the input data to [.1, .9].  The Agg</span>
                <span class="c1"># interpolators clip to [0, 1] internally, use a</span>
                <span class="c1"># smaller input scale to identify which of the</span>
                <span class="c1"># interpolated points need to be should be flagged as</span>
                <span class="c1"># over / under.</span>
                <span class="c1"># This may introduce numeric instabilities in very broadly</span>
                <span class="c1"># scaled data</span>
                <span class="n">A_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">scaled_dtype</span><span class="p">)</span>
                <span class="n">A_scaled</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">A</span>
                <span class="c1"># clip scaled data around norm if necessary.</span>
                <span class="c1"># This is necessary for big numbers at the edge of</span>
                <span class="c1"># float64's ability to represent changes.  Applying</span>
                <span class="c1"># a norm first would be good, but ruins the interpolation</span>
                <span class="c1"># of over numbers.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dv</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span> <span class="o">-</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span><span class="p">))</span>
                    <span class="n">vmid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span> <span class="o">+</span> <span class="n">dv</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">newmin</span> <span class="o">=</span> <span class="n">vmid</span> <span class="o">-</span> <span class="n">dv</span> <span class="o">*</span> <span class="mf">1.e7</span>
                    <span class="k">if</span> <span class="n">newmin</span> <span class="o">&lt;</span> <span class="n">a_min</span><span class="p">:</span>
                        <span class="n">newmin</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">a_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">newmin</span><span class="p">)</span>
                    <span class="n">newmax</span> <span class="o">=</span> <span class="n">vmid</span> <span class="o">+</span> <span class="n">dv</span> <span class="o">*</span> <span class="mf">1.e7</span>
                    <span class="k">if</span> <span class="n">newmax</span> <span class="o">&gt;</span> <span class="n">a_max</span><span class="p">:</span>
                        <span class="n">newmax</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">a_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">newmax</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">newmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">newmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">A_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">A_scaled</span><span class="p">,</span> <span class="n">newmin</span><span class="p">,</span> <span class="n">newmax</span><span class="p">)</span>

                <span class="n">A_scaled</span> <span class="o">-=</span> <span class="n">a_min</span>
                <span class="c1"># a_min and a_max might be ndarray subclasses so use</span>
                <span class="c1"># asscalar to ensure they are scalars to avoid errors</span>
                <span class="n">a_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">a_min</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">scaled_dtype</span><span class="p">))</span>
                <span class="n">a_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">a_max</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">scaled_dtype</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">a_min</span> <span class="o">!=</span> <span class="n">a_max</span><span class="p">:</span>
                    <span class="n">A_scaled</span> <span class="o">/=</span> <span class="p">((</span><span class="n">a_max</span> <span class="o">-</span> <span class="n">a_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.8</span><span class="p">)</span>
                <span class="n">A_scaled</span> <span class="o">+=</span> <span class="mf">0.1</span>
                <span class="n">A_resampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">),</span>
                                       <span class="n">dtype</span><span class="o">=</span><span class="n">A_scaled</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="c1"># resample the input data to the correct resolution and shape</span>
                <span class="n">_image</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">A_scaled</span><span class="p">,</span> <span class="n">A_resampled</span><span class="p">,</span>
                                <span class="n">t</span><span class="p">,</span>
                                <span class="n">_interpd_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interpolation</span><span class="p">()],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_resample</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_filternorm</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_filterrad</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">)</span>

                <span class="c1"># we are done with A_scaled now, remove from namespace</span>
                <span class="c1"># to be sure!</span>
                <span class="k">del</span> <span class="n">A_scaled</span>
                <span class="c1"># un-scale the resampled data to approximately the</span>
                <span class="c1"># original range things that interpolated to above /</span>
                <span class="c1"># below the original min/max will still be above /</span>
                <span class="c1"># below, but possibly clipped in the case of higher order</span>
                <span class="c1"># interpolation + drastically changing data.</span>
                <span class="n">A_resampled</span> <span class="o">-=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="n">a_min</span> <span class="o">!=</span> <span class="n">a_max</span><span class="p">:</span>
                    <span class="n">A_resampled</span> <span class="o">*=</span> <span class="p">((</span><span class="n">a_max</span> <span class="o">-</span> <span class="n">a_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.8</span><span class="p">)</span>
                <span class="n">A_resampled</span> <span class="o">+=</span> <span class="n">a_min</span>
                <span class="c1"># if using NoNorm, cast back to the original datatype</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">NoNorm</span><span class="p">):</span>
                    <span class="n">A_resampled</span> <span class="o">=</span> <span class="n">A_resampled</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="c1"># this is the case of a nontrivial mask</span>
                    <span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># we always have to interpolate the mask to account for</span>
                <span class="c1"># non-affine transformations</span>
                <span class="n">out_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">_image</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">out_mask</span><span class="p">,</span>
                                <span class="n">t</span><span class="p">,</span>
                                <span class="n">_interpd_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interpolation</span><span class="p">()],</span>
                                <span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_filternorm</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_filterrad</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="c1"># we are done with the mask, delete from namespace to be sure!</span>
                <span class="k">del</span> <span class="n">mask</span>
                <span class="c1"># Agg updates the out_mask in place.  If the pixel has</span>
                <span class="c1"># no image data it will not be updated (and still be 0</span>
                <span class="c1"># as we initialized it), if input data that would go</span>
                <span class="c1"># into that output pixel than it will be `nan`, if all</span>
                <span class="c1"># the input data for a pixel is good it will be 1, and</span>
                <span class="c1"># if there is _some_ good data in that output pixel it</span>
                <span class="c1"># will be between [0, 1] (such as a rotated image).</span>

                <span class="n">out_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out_mask</span><span class="p">)</span>
                <span class="n">out_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">out_mask</span><span class="p">)</span>
                <span class="n">out_alpha</span><span class="p">[</span><span class="n">out_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># mask and run through the norm</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">A_resampled</span><span class="p">,</span> <span class="n">out_mask</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Always convert to RGBA, even if only RGB input</span>
                <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">A</span> <span class="o">=</span> <span class="n">_rgb_to_rgba</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid dimensions, got </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>

                <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

                <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="n">_image</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span>
                    <span class="n">A</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_interpd_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interpolation</span><span class="p">()],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_resample</span><span class="p">(),</span> <span class="n">alpha</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_filternorm</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filterrad</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># at this point output is either a 2D array of normed data</span>
            <span class="c1"># (of int or float)</span>
            <span class="c1"># or an RGBA array of re-sampled input</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># output is now a correctly sized RGBA array of uint8</span>

            <span class="c1"># Apply alpha *after* if the input was greyscale without a mask</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">alpha_channel</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span>
                <span class="n">alpha_channel</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha_channel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">out_alpha</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span>

            <span class="c1"># Subset the input image to only the part that will be</span>
            <span class="c1"># displayed</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">TransformedBbox</span><span class="p">(</span>
                <span class="n">clip_bbox</span><span class="p">,</span> <span class="n">t0</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">xmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">subset</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="o">+</span> <span class="n">t</span>

        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">clipped_bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">clipped_bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'The make_image method must be overridden.'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_unsampled_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        draw unsampled image. The renderer should support a draw_image method</span>
<span class="sd">        with scale parameter.</span>
<span class="sd">        """</span>

        <span class="n">im</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_image</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">trans</span>

        <span class="n">renderer</span><span class="o">.</span><span class="n">draw_image</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_unsampled_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        return True if the image is better to be drawn unsampled.</span>
<span class="sd">        The derived class needs to override it.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@allow_rasterization</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># if not visible, declare victory and return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="c1"># for empty images, there is nothing to draw!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="c1"># actually render the image.</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gc_clip</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">())</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_url</span><span class="p">())</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_gid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_gid</span><span class="p">())</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_unsampled_image</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">is_affine</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_unsampled_image</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">gc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_image</span><span class="p">(</span>
                <span class="n">renderer</span><span class="p">,</span> <span class="n">renderer</span><span class="o">.</span><span class="n">get_image_magnification</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">renderer</span><span class="o">.</span><span class="n">draw_image</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Test whether the mouse event occurred within the image.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>
        <span class="c1"># TODO: make sure this is consistent with patch and patch</span>
        <span class="c1"># collection on nonlinear transformed coordinates.</span>
        <span class="c1"># TODO: consider returning image coordinates (shouldn't</span>
        <span class="c1"># be too difficult given that the image is rectilinear</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xmin</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span>
        <span class="k">if</span> <span class="n">ymin</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">inside</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">write_png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">"""Write the image to png file with fname"""</span>
        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s1">'lower'</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span>
                          <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">_png</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the image array.</span>

<span class="sd">        ACCEPTS: numpy/PIL Image A</span>

<span class="sd">        Note that this function does *not* update the normalization used.</span>
<span class="sd">        """</span>
        <span class="c1"># check if data is PIL Image without importing Image</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s1">'getpixel'</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'L'</span><span class="p">:</span>
                <span class="c1"># greyscale image, but our logic assumes rgba:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">pil_to_array</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'RGBA'</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">pil_to_array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">safe_masked_invalid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">can_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">"same_kind"</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Image data cannot be converted to float"</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Invalid dimensions for image data"</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># If the input data has values outside the valid range (after</span>
            <span class="c1"># normalisation), we issue a warning and then clip X to the bounds</span>
            <span class="c1"># - otherwise casting wraps extreme values, hiding outliers and</span>
            <span class="c1"># making reliable interpretation impossible.</span>
            <span class="n">high</span> <span class="o">=</span> <span class="mi">255</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">'Clipping input data to the valid range for imshow with '</span>
                    <span class="s1">'RGB data ([0..1] for floats or [0..255] for integers).'</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
            <span class="c1"># Cast unsupported integer types to uint8</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Retained for backwards compatibility - use set_data instead</span>

<span class="sd">        ACCEPTS: numpy array A or PIL Image</span>
<span class="sd">        """</span>
        <span class="c1"># This also needs to be here to override the inherited</span>
        <span class="c1"># cm.ScalarMappable.set_array method so it is not invoked</span>
        <span class="c1"># by mistake.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return the interpolation method the image uses when resizing.</span>

<span class="sd">        One of 'nearest', 'bilinear', 'bicubic', 'spline16', 'spline36',</span>
<span class="sd">        'hanning', 'hamming', 'hermite', 'kaiser', 'quadric', 'catrom',</span>
<span class="sd">        'gaussian', 'bessel', 'mitchell', 'sinc', 'lanczos', or 'none'.</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span>

    <span class="k">def</span> <span class="nf">set_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the interpolation method the image uses when resizing.</span>

<span class="sd">        if None, use a value from rc setting. If 'none', the image is</span>
<span class="sd">        shown as is without interpolating. 'none' is only supported in</span>
<span class="sd">        agg, ps and pdf backends and will fall back to 'nearest' mode</span>
<span class="sd">        for other backends.</span>

<span class="sd">        .. ACCEPTS: ['nearest' | 'bilinear' | 'bicubic' | 'spline16' |</span>
<span class="sd">           'spline36' | 'hanning' | 'hamming' | 'hermite' | 'kaiser' |</span>
<span class="sd">           'quadric' | 'catrom' | 'gaussian' | 'bessel' | 'mitchell' |</span>
<span class="sd">           'sinc' | 'lanczos' | 'none' ]</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'image.interpolation'</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_interpd_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Illegal interpolation string'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">can_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns `True` if the image can be composited with its neighbors.</span>
<span class="sd">        """</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span> <span class="o">!=</span> <span class="s1">'none'</span> <span class="ow">and</span>
            <span class="n">trans</span><span class="o">.</span><span class="n">is_affine</span> <span class="ow">and</span>
            <span class="n">trans</span><span class="o">.</span><span class="n">is_separable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set whether or not image resampling is used.</span>

<span class="sd">        ACCEPTS: True|False</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'image.resample'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_resample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return the image resample boolean."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resample</span>

    <span class="k">def</span> <span class="nf">set_filternorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filternorm</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set whether the resize filter norms the weights -- see</span>
<span class="sd">        help for imshow</span>

<span class="sd">        ACCEPTS: 0 or 1</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">filternorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filternorm</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filternorm</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_filternorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return the filternorm setting."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filternorm</span>

    <span class="k">def</span> <span class="nf">set_filterrad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterrad</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the resize filter radius only applicable to some</span>
<span class="sd">        interpolation schemes -- see help for imshow</span>

<span class="sd">        ACCEPTS: positive float</span>
<span class="sd">        """</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filterrad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"The filter radius must be a positive number"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filterrad</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_filterrad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return the filterrad setting."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterrad</span>


<div class="viewcode-block" id="AxesImage"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage">[docs]</a><span class="k">class</span> <span class="nc">AxesImage</span><span class="p">(</span><span class="n">_ImageBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"AxesImage(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">;</span><span class="si">%g</span><span class="s2">x</span><span class="si">%g</span><span class="s2">)"</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">filternorm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">filterrad</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                 <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>

        <span class="sd">"""</span>
<span class="sd">        interpolation and cmap default to their rc settings</span>

<span class="sd">        cmap is a colors.Colormap instance</span>
<span class="sd">        norm is a colors.Normalize instance to map luminance to 0-1</span>

<span class="sd">        extent is data axes (left, right, bottom, top) for making image plots</span>
<span class="sd">        registered with data plots.  Default is to label the pixel</span>
<span class="sd">        centers with the zero-based row and column indices.</span>

<span class="sd">        Additional kwargs are matplotlib.artist properties</span>

<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span> <span class="o">=</span> <span class="n">extent</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AxesImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">filternorm</span><span class="o">=</span><span class="n">filternorm</span><span class="p">,</span>
            <span class="n">filterrad</span><span class="o">=</span><span class="n">filterrad</span><span class="p">,</span>
            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

<div class="viewcode-block" id="AxesImage.get_window_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage.get_window_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="o">.</span><span class="n">from_extents</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">bbox</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span></div>

<div class="viewcode-block" id="AxesImage.make_image"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage.make_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
        <span class="c1"># image is created in the canvas coordinate.</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="p">[</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]]))</span>
        <span class="n">transformed_bbox</span> <span class="o">=</span> <span class="n">TransformedBbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_image</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">transformed_bbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="p">,</span> <span class="n">magnification</span><span class="p">,</span>
            <span class="n">unsampled</span><span class="o">=</span><span class="n">unsampled</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_unsampled_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return whether the image would be better drawn unsampled.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interpolation</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"none"</span>
                <span class="ow">and</span> <span class="n">renderer</span><span class="o">.</span><span class="n">option_scale_image</span><span class="p">())</span>

<div class="viewcode-block" id="AxesImage.set_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage.set_extent">[docs]</a>    <span class="k">def</span> <span class="nf">set_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        extent is data axes (left, right, bottom, top) for making image plots</span>

<span class="sd">        This updates ax.dataLim, and, if autoscaling, sets viewLim</span>
<span class="sd">        to tightly fit the image, regardless of dataLim.  Autoscaling</span>
<span class="sd">        state is not changed, so following this with ax.autoscale_view</span>
<span class="sd">        will redo the autoscaling in accord with dataLim.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extent</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">update_datalim</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sticky_edges</span><span class="o">.</span><span class="n">x</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sticky_edges</span><span class="o">.</span><span class="n">y</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_autoscaleXon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">auto</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_autoscaleYon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">auto</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AxesImage.get_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage.get_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Get the image extent: left, right, bottom, top"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
            <span class="n">numrows</span><span class="p">,</span> <span class="n">numcols</span> <span class="o">=</span> <span class="n">sz</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s1">'upper'</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">numcols</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">numrows</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">numcols</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">numrows</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span></div>

<div class="viewcode-block" id="AxesImage.get_cursor_data"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.AxesImage.get_cursor_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_cursor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Get the cursor data for a given event"""</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s1">'upper'</span><span class="p">:</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
        <span class="n">data_extent</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">([[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">],</span> <span class="p">[</span><span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">]])</span>
        <span class="n">array_extent</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">BboxTransform</span><span class="p">(</span><span class="n">boxin</span><span class="o">=</span><span class="n">data_extent</span><span class="p">,</span> <span class="n">boxout</span><span class="o">=</span><span class="n">array_extent</span><span class="p">)</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_point</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">point</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Clip the coordinates at array bounds</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="NonUniformImage"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage">[docs]</a><span class="k">class</span> <span class="nc">NonUniformImage</span><span class="p">(</span><span class="n">AxesImage</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        kwargs are identical to those for AxesImage, except</span>
<span class="sd">        that 'nearest' and 'bilinear' are the only supported 'interpolation'</span>
<span class="sd">        options.</span>
<span class="sd">        """</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'interpolation'</span><span class="p">,</span> <span class="s1">'nearest'</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NonUniformImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_interpolation</span><span class="p">(</span><span class="n">interp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_unsampled_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        return False. Do not use unsampled image.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="NonUniformImage.make_image"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.make_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'You must first set the image array'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unsampled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'unsampled not supported on NonUniformImage'</span><span class="p">)</span>

        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">is_gray</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">B</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
                <span class="n">B</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">B</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">v_width</span><span class="p">,</span> <span class="n">v_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">extents</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">*=</span> <span class="n">magnification</span>
        <span class="n">height</span> <span class="o">*=</span> <span class="n">magnification</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">_image</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span>
                           <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="o">+</span><span class="n">v_width</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">v_height</span><span class="p">),</span>
                           <span class="n">_interpd_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">IdentityTransform</span><span class="p">()</span></div>

<div class="viewcode-block" id="NonUniformImage.set_data"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the grid for the pixel centers, and the pixel values.</span>

<span class="sd">          *x* and *y* are monotonic 1-D ndarrays of lengths N and M,</span>
<span class="sd">             respectively, specifying pixel centers</span>

<span class="sd">          *A* is an (M,N) ndarray or masked array of values to be</span>
<span class="sd">            colormapped, or a (M,N,3) RGB array, or a (M,N,4) RGBA</span>
<span class="sd">            array.</span>
<span class="sd">        """</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">safe_masked_invalid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Axes don't match array shape"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Can only plot 2D or 3D data"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"3D arrays must have three (RGB) "</span>
                            <span class="s2">"or four (RGBA) color components"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">A</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imcache</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NonUniformImage.set_array"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_array">[docs]</a>    <span class="k">def</span> <span class="nf">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Method not supported'</span><span class="p">)</span></div>

<div class="viewcode-block" id="NonUniformImage.set_interpolation"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_interpolation">[docs]</a>    <span class="k">def</span> <span class="nf">set_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str, None</span>
<span class="sd">            Either 'nearest', 'bilinear', or ``None``.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'nearest'</span><span class="p">,</span> <span class="s1">'bilinear'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Only nearest neighbor and '</span>
                                      <span class="s1">'bilinear interpolations are supported'</span><span class="p">)</span>
        <span class="n">AxesImage</span><span class="o">.</span><span class="n">set_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="NonUniformImage.get_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.get_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Must set data first'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="NonUniformImage.set_filternorm"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_filternorm">[docs]</a>    <span class="k">def</span> <span class="nf">set_filternorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NonUniformImage.set_filterrad"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_filterrad">[docs]</a>    <span class="k">def</span> <span class="nf">set_filterrad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NonUniformImage.set_norm"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_norm">[docs]</a>    <span class="k">def</span> <span class="nf">set_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norm</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Cannot change colors after loading data'</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NonUniformImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span></div>

<div class="viewcode-block" id="NonUniformImage.set_cmap"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.NonUniformImage.set_cmap">[docs]</a>    <span class="k">def</span> <span class="nf">set_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Cannot change colors after loading data'</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NonUniformImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PcolorImage"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.PcolorImage">[docs]</a><span class="k">class</span> <span class="nc">PcolorImage</span><span class="p">(</span><span class="n">AxesImage</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Make a pcolor-style plot with an irregular rectangular grid.</span>

<span class="sd">    This uses a variation of the original irregular image code,</span>
<span class="sd">    and it is used by pcolorfast for the corresponding grid type.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span>
                 <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        cmap defaults to its rc setting</span>

<span class="sd">        cmap is a colors.Colormap instance</span>
<span class="sd">        norm is a colors.Normalize instance to map luminance to 0-1</span>

<span class="sd">        Additional kwargs are matplotlib.artist properties</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PcolorImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<div class="viewcode-block" id="PcolorImage.make_image"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.PcolorImage.make_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'You must first set the image array'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unsampled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'unsampled not supported on PColorImage'</span><span class="p">)</span>
        <span class="n">fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bg</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">extents</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="c1"># The extra cast-to-int is only needed for python2</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">magnification</span><span class="p">))</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">magnification</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span> <span class="o">=</span> <span class="n">A</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">is_gray</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">_image</span><span class="o">.</span><span class="n">pcolor2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span>
                            <span class="n">height</span><span class="p">,</span>
                            <span class="n">width</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">y1</span><span class="p">),</span>
                            <span class="n">bg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">IdentityTransform</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_check_unsampled_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="PcolorImage.set_data"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.PcolorImage.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the grid for the rectangle boundaries, and the data values.</span>

<span class="sd">          *x* and *y* are monotonic 1-D ndarrays of lengths N+1 and M+1,</span>
<span class="sd">             respectively, specifying rectangle boundaries.  If None,</span>
<span class="sd">             they will be created as uniform arrays from 0 through N</span>
<span class="sd">             and 0 through M, respectively.</span>

<span class="sd">          *A* is an (M,N) ndarray or masked array of values to be</span>
<span class="sd">            colormapped, or a (M,N,3) RGB array, or a (M,N,4) RGBA</span>
<span class="sd">            array.</span>

<span class="sd">        """</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">safe_masked_invalid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Axes don't match array shape. Got </span><span class="si">%s</span><span class="s2">, expected </span><span class="si">%s</span><span class="s2">."</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"A must be 2D or 3D"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">A</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_grayscale</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"3D arrays must have RGB or RGBA as last dim"</span><span class="p">)</span>

        <span class="c1"># For efficient cursor readout, ensure x and y are increasing.</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgbacache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PcolorImage.set_array"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.PcolorImage.set_array">[docs]</a>    <span class="k">def</span> <span class="nf">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Method not supported'</span><span class="p">)</span></div>

<div class="viewcode-block" id="PcolorImage.get_cursor_data"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.PcolorImage.get_cursor_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_cursor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Get the cursor data for a given event"""</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ax</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ay</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="FigureImage"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.FigureImage">[docs]</a><span class="k">class</span> <span class="nc">FigureImage</span><span class="p">(</span><span class="n">_ImageBase</span><span class="p">):</span>
    <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_interpolation</span> <span class="o">=</span> <span class="s1">'nearest'</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">offsetx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">offsety</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        cmap is a colors.Colormap instance</span>
<span class="sd">        norm is a colors.Normalize instance to map luminance to 0-1</span>

<span class="sd">        kwargs are an optional list of Artist keyword args</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FigureImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ox</span> <span class="o">=</span> <span class="n">offsetx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oy</span> <span class="o">=</span> <span class="n">offsety</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnification</span> <span class="o">=</span> <span class="mf">1.0</span>

<div class="viewcode-block" id="FigureImage.get_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.FigureImage.get_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Get the image extent: left, right, bottom, top"""</span>
        <span class="n">numrows</span><span class="p">,</span> <span class="n">numcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="p">,</span> <span class="n">numcols</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="p">,</span> <span class="n">numrows</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="p">)</span></div>

<div class="viewcode-block" id="FigureImage.make_image"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.FigureImage.make_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">dpi</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
        <span class="c1"># fac here is to account for pdf, eps, svg backends where</span>
        <span class="c1"># figure.dpi is set to 72.  This means we need to scale the</span>
        <span class="c1"># image (using magification) and offset it appropriately.</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="o">/</span><span class="n">fac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="o">/</span><span class="n">fac</span><span class="p">],</span>
                     <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="o">/</span><span class="n">fac</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="o">/</span><span class="n">fac</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]])</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="n">width</span> <span class="o">*=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">dpi</span>
        <span class="n">height</span> <span class="o">*=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">dpi</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_image</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="n">magnification</span> <span class="o">/</span> <span class="n">fac</span><span class="p">,</span>
            <span class="n">unsampled</span><span class="o">=</span><span class="n">unsampled</span><span class="p">,</span> <span class="n">round_to_pixel_border</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="FigureImage.set_data"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.FigureImage.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">"""Set the image array."""</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">cbook</span><span class="o">.</span><span class="n">safe_masked_invalid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="BboxImage"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.BboxImage">[docs]</a><span class="k">class</span> <span class="nc">BboxImage</span><span class="p">(</span><span class="n">_ImageBase</span><span class="p">):</span>
    <span class="sd">"""The Image class whose size is determined by the given bbox."""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">filternorm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">filterrad</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                 <span class="n">resample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">interp_at_native</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        cmap is a colors.Colormap instance</span>
<span class="sd">        norm is a colors.Normalize instance to map luminance to 0-1</span>

<span class="sd">        interp_at_native is a flag that determines whether or not</span>
<span class="sd">        interpolation should still be applied when the image is</span>
<span class="sd">        displayed at its native resolution.  A common use case for this</span>
<span class="sd">        is when displaying an image for annotational purposes; it is</span>
<span class="sd">        treated similarly to Photoshop (interpolation is only used when</span>
<span class="sd">        displaying the image at non-native resolutions).</span>


<span class="sd">        kwargs are an optional list of Artist keyword args</span>

<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BboxImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">filternorm</span><span class="o">=</span><span class="n">filternorm</span><span class="p">,</span>
            <span class="n">filterrad</span><span class="o">=</span><span class="n">filterrad</span><span class="p">,</span>
            <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="n">bbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_at_native</span> <span class="o">=</span> <span class="n">interp_at_native</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">IdentityTransform</span><span class="p">()</span>

<div class="viewcode-block" id="BboxImage.get_transform"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.BboxImage.get_transform">[docs]</a>    <span class="k">def</span> <span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span></div>

<div class="viewcode-block" id="BboxImage.get_window_extent"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.BboxImage.get_window_extent">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">renderer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">_cachedRenderer</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">,</span> <span class="n">BboxBase</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"unknown type of bbox"</span><span class="p">)</span></div>

<div class="viewcode-block" id="BboxImage.contains"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.BboxImage.contains">[docs]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">):</span>
        <span class="sd">"""Test whether the mouse event occurred within the image."""</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>  <span class="c1"># or self.get_figure()._renderer is None:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">y</span>
        <span class="n">inside</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inside</span><span class="p">,</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="BboxImage.make_image"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.BboxImage.make_image">[docs]</a>    <span class="k">def</span> <span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">magnification</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">get_canvas_width_height</span><span class="p">()</span>

        <span class="n">bbox_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
        <span class="n">bbox_in</span><span class="o">.</span><span class="n">_points</span> <span class="o">/=</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
        <span class="n">bbox_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="n">Bbox</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">BboxTransform</span><span class="p">(</span><span class="n">Bbox</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">clip</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_image</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span>
            <span class="n">bbox_in</span><span class="p">,</span> <span class="n">bbox_out</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="n">magnification</span><span class="p">,</span> <span class="n">unsampled</span><span class="o">=</span><span class="n">unsampled</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="imread"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.imread">[docs]</a><span class="k">def</span> <span class="nf">imread</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Read an image from a file into an array.</span>

<span class="sd">    *fname* may be a string path, a valid URL, or a Python</span>
<span class="sd">    file-like object.  If using a file object, it must be opened in binary</span>
<span class="sd">    mode.</span>

<span class="sd">    If *format* is provided, will try to read file of that type,</span>
<span class="sd">    otherwise the format is deduced from the filename.  If nothing can</span>
<span class="sd">    be deduced, PNG is tried.</span>

<span class="sd">    Return value is a :class:`numpy.array`.  For grayscale images, the</span>
<span class="sd">    return array is MxN.  For RGB images, the return value is MxNx3.</span>
<span class="sd">    For RGBA images the return value is MxNx4.</span>

<span class="sd">    matplotlib can only read PNGs natively, but if `PIL</span>
<span class="sd">    &lt;http://www.pythonware.com/products/pil/&gt;`_ is installed, it will</span>
<span class="sd">    use it to load the image and return an array (if possible) which</span>
<span class="sd">    can be used with :func:`~matplotlib.pyplot.imshow`. Note, URL strings</span>
<span class="sd">    may not be compatible with PIL. Check the PIL documentation for more</span>
<span class="sd">    information.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">pilread</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="sd">"""try to load the image with PIL or return None"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pil_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'png'</span><span class="p">:</span> <span class="n">_png</span><span class="o">.</span><span class="n">read_png</span><span class="p">,</span> <span class="p">}</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="c1"># If the string is a URL, assume png</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s1">'png'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">):</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s1">'png'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="nb">format</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">pilread</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">im</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Only know how to handle extensions: </span><span class="si">%s</span><span class="s1">; '</span>
                             <span class="s1">'with Pillow installed matplotlib can handle '</span>
                             <span class="s1">'more images'</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">handlers</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">im</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">handlers</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>

    <span class="c1"># To handle Unicode filenames, we pass a file object to the PNG</span>
    <span class="c1"># reader extension, since Python handles them quite well, but it's</span>
    <span class="c1"># tricky in C.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="c1"># If fname is a URL, download the data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>


<div class="viewcode-block" id="imsave"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.imsave">[docs]</a><span class="k">def</span> <span class="nf">imsave</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Save an array as in image file.</span>

<span class="sd">    The output formats available depend on the backend being used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str or file-like</span>
<span class="sd">        Path string to a filename, or a Python file-like object.</span>
<span class="sd">        If *format* is *None* and *fname* is a string, the output</span>
<span class="sd">        format is deduced from the extension of the filename.</span>
<span class="sd">    arr : array-like</span>
<span class="sd">        An MxN (luminance), MxNx3 (RGB) or MxNx4 (RGBA) array.</span>
<span class="sd">    vmin, vmax: [ None | scalar ]</span>
<span class="sd">        *vmin* and *vmax* set the color scaling for the image by fixing the</span>
<span class="sd">        values that map to the colormap color limits. If either *vmin*</span>
<span class="sd">        or *vmax* is None, that limit is determined from the *arr*</span>
<span class="sd">        min/max value.</span>
<span class="sd">    cmap : matplotlib.colors.Colormap, optional</span>
<span class="sd">        For example, ``cm.viridis``.  If ``None``, defaults to the</span>
<span class="sd">        ``image.cmap`` rcParam.</span>
<span class="sd">    format : str</span>
<span class="sd">        One of the file extensions supported by the active backend.  Most</span>
<span class="sd">        backends support png, pdf, ps, eps and svg.</span>
<span class="sd">    origin : [ 'upper' | 'lower' ]</span>
<span class="sd">        Indicates whether the ``(0, 0)`` index of the array is in the</span>
<span class="sd">        upper left or lower left corner of the axes.  Defaults to the</span>
<span class="sd">        ``image.origin`` rcParam.</span>
<span class="sd">    dpi : int</span>
<span class="sd">        The DPI to store in the metadata of the file.  This does not affect the</span>
<span class="sd">        resolution of the output image.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="k">import</span> <span class="n">FigureCanvasAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
    <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">"PathLike"</span><span class="p">,</span> <span class="p">())):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">format</span> <span class="o">==</span> <span class="s1">'png'</span>
        <span class="ow">or</span> <span class="p">(</span><span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.png'</span><span class="p">))):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">AxesImage</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">figimage</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
                     <span class="n">resize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="pil_to_array"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.pil_to_array">[docs]</a><span class="k">def</span> <span class="nf">pil_to_array</span><span class="p">(</span><span class="n">pilImage</span><span class="p">):</span>
    <span class="sd">"""Load a PIL image and return it as a numpy array.</span>

<span class="sd">    Grayscale images are returned as ``(M, N)`` arrays.  RGB images are</span>
<span class="sd">    returned as ``(M, N, 3)`` arrays.  RGBA images are returned as ``(M, N,</span>
<span class="sd">    4)`` arrays.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'RGBA'</span><span class="p">,</span> <span class="s1">'RGBX'</span><span class="p">,</span> <span class="s1">'RGB'</span><span class="p">,</span> <span class="s1">'L'</span><span class="p">]:</span>
        <span class="c1"># return MxNx4 RGBA, MxNx3 RBA, or MxN luminance array</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pilImage</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'I;16'</span><span class="p">):</span>
        <span class="c1"># return MxN luminance array of uint16</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="s1">'raw'</span><span class="p">,</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'B'</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s1">'&gt;u2'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s1">'&lt;u2'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pilImage</span><span class="o">.</span><span class="n">size</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'=u2'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># try to convert to an rgba image</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pilImage</span> <span class="o">=</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'RGBA'</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Unknown image mode'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pilImage</span><span class="p">)</span>  <span class="c1"># return MxNx4 RGBA array</span></div>


<div class="viewcode-block" id="thumbnail"><a class="viewcode-back" href="../../api/image_api.html#matplotlib.image.thumbnail">[docs]</a><span class="k">def</span> <span class="nf">thumbnail</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">thumbfile</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">'bilinear'</span><span class="p">,</span>
              <span class="n">preview</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    make a thumbnail of image in *infile* with output filename</span>
<span class="sd">    *thumbfile*.</span>

<span class="sd">      *infile* the image file -- must be PNG or Pillow-readable if you</span>
<span class="sd">         have `Pillow &lt;http://python-pillow.org/&gt;`_ installed</span>

<span class="sd">      *thumbfile*</span>
<span class="sd">        the thumbnail filename</span>

<span class="sd">      *scale*</span>
<span class="sd">        the scale factor for the thumbnail</span>

<span class="sd">      *interpolation*</span>
<span class="sd">        the interpolation scheme used in the resampling</span>


<span class="sd">      *preview*</span>
<span class="sd">        if True, the default backend (presumably a user interface</span>
<span class="sd">        backend) will be used which will cause a figure to be raised</span>
<span class="sd">        if :func:`~matplotlib.pyplot.show` is called.  If it is False,</span>
<span class="sd">        a pure image backend will be used depending on the extension,</span>
<span class="sd">        'png'-&gt;FigureCanvasAgg, 'pdf'-&gt;FigureCanvasPdf,</span>
<span class="sd">        'svg'-&gt;FigureCanvasSVG</span>


<span class="sd">    See examples/misc/image_thumbnail.py.</span>

<span class="sd">    .. htmlonly::</span>

<span class="sd">        :ref:`sphx_glr_gallery_misc_image_thumbnail_sgskip.py`</span>

<span class="sd">    Return value is the figure instance containing the thumbnail</span>

<span class="sd">    """</span>
    <span class="n">basedir</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">baseout</span><span class="p">,</span> <span class="n">extout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">thumbfile</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># this doesn't really matter, it will cancel in the end, but we</span>
    <span class="c1"># need it for the mpl API</span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">height</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">/</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="n">extension</span> <span class="o">=</span> <span class="n">extout</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">preview</span><span class="p">:</span>
        <span class="c1"># let the UI backend do everything</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">'.png'</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> \
                <span class="kn">import</span> <span class="nn">FigureCanvasAgg</span> <span class="k">as</span> <span class="nn">FigureCanvas</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">'.pdf'</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> \
                <span class="kn">import</span> <span class="nn">FigureCanvasPdf</span> <span class="k">as</span> <span class="nn">FigureCanvas</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">'.svg'</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_svg</span> \
                <span class="kn">import</span> <span class="nn">FigureCanvasSVG</span> <span class="k">as</span> <span class="nn">FigureCanvas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Can only handle "</span>
                             <span class="s2">"extensions 'png', 'svg' or 'pdf'"</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span>
                      <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">thumbfile</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>
</pre></div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div class="footer">
        © Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2018 The Matplotlib development team.
        <br/>
      Last updated on Jun 28, 2018.
	Created using
	<ahref>Sphinx 1.7.5.
	Doc version v2.2.2-101-g15e1eadd0.
    </ahref></div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55954603-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
<footer>
<!--Flipcause Integration v3.0// Flipcause Integration Instructions:
Install the following code block once in the website Header (after <head> tag) -->
<style>

.fc-black_overlay{
display:none; position: fixed; z-index:1000001; top: 0%;left: 0%;width: 100%;height: 100%;
background-color: black; filter: alpha(opacity=50); cursor:pointer; opacity:0.5;
}

.fc-white_content {
opacity:1; display:none; margin-top: -320px; margin-left: -485px; width:970px; height:640px;
position:fixed; top:50%; left:50%; border: none;z-index:1000002;overflow: auto;
}

.fc-main-box{
opacity:1; display:none; margin:15px auto 0 auto; width:930px; position:relative; z-index:1000003;
}

.fc-widget_close{
opacity:1; content:url(http://i1338.photobucket.com/albums/o691/WeCause/X_zpse4a7e538.png);
position:absolute; z-index=1000004; right:-16px; top:-16px; display:block; cursor:pointer;
}

.floating_button{
display: block; margin-top: 0px; margin-left: 0px; width:auto ; height: auto;
position:fixed; z-index:999999; overflow: auto;
}

@keyframes backfadesin {
   from { opacity:0; }
   to {opacity:.5;}
}

@-moz-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-webkit-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-o-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}


@-ms-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; transform: translateY(20px);}
   100% {opacity: 1; transform: translateY(0);}
}

@-moz-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -moz-transform: translateY(20px);}
   100% {opacity: 1; -moz-transform: translateY(0);}
}

@-webkit-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -webkit-transform: translateY(20px);}
   100% {opacity: 1; -webkit-transform: translateY(0);}
}

@-o-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -o-transform: translateY(20px);}
   100% {opacity: 1; -o-transform: translateY(0);}
}

@-ms-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -ms-transform: translateY(20px);}
   100% {opacity: 1; -ms-transform: translateY(0);}
}

</style>
<div class="fc-black_overlay" id="fc-fade" onclick="close_window()"></div>
<div class="fc-white_content" id="fc-light">
<div class="fc-main-box" id="fc-main">
<div class="fc-widget_close" id="fc-close" onclick="close_window()">
</div><iframe height="580" id="fc-myFrame" iframe="" scrolling="no" src="" style="border: 0;
border-radius:5px 5px 5px 5px; box-shadow:0 0 8px rgba(0, 0, 0, 0.5);" width="925"></iframe></div>
</div>
<!--END Flipcause Main Integration Code-->
</footer>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>matplotlib.mathtext — Matplotlib 2.2.2 documentation</title>
<link href="../../_static/mpl.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/gallery.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../_static/opensearch.xml" rel="search" title="Search within Matplotlib 2.2.2 documentation" type="application/opensearchdescription+xml"/>
<link href="../../_static/favicon.ico" rel="shortcut icon"/>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../../index.html" rel="top" title="Matplotlib 2.2.2 documentation"/>
<link href="../matplotlib.html" rel="up" title="matplotlib"/>
<link href="https://matplotlib.org/_modules/matplotlib/mathtext.html" rel="canonical"/>
<link href="https://matplotlib.org/_modules/matplotlib/mathtext.html" rel="canonical"/></head>
<body><div id="old-version-banner">
            You are reading documentation for a static version of Matplotlib.
            <a href="https://matplotlib.org/_modules/matplotlib/mathtext.html">This page may have been updated.</a>
</div>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
<a href="../../index.html">
<div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 2.2.2</span></div>
<img alt="matplotlib" border="0" height="125px" src="../../_static/logo2.png"/></a>
<!-- The "Fork me on github" ribbon -->
<div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
</div>
<div class="related">
<h3>Navigation</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a accesskey="I" href="../../genindex.html" title="General Index">index</a></li>
<li class="right">
<a href="../../py-modindex.html" title="Python Module Index">modules</a> |</li>
<li><a href="../../index.html">home</a>| </li>
<li><a href="../../gallery/index.html">examples</a>| </li>
<li><a href="../../tutorials/index.html">tutorials</a>| </li>
<li><a href="../../api/pyplot_summary.html">pyplot</a>| </li>
<li><a href="../../contents.html">docs</a> »</li>
<li><a href="../index.html">Module code</a> »</li>
<li><a accesskey="U" href="../matplotlib.html">matplotlib</a> »</li>
</ul>
</div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<div id="searchbox" role="search" style="display: none">
<h3>Quick search</h3>
<div class="searchformwrapper">
<form action="../../search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
<li><a href="../../contents.html">Documentation overview</a><ul>
<li><a href="../index.html">Module code</a><ul>
<li><a href="../matplotlib.html">matplotlib</a><ul>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body">
<h1>Source code for matplotlib.mathtext</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">"""</span>
<span class="sd">:mod:`~matplotlib.mathtext` is a module for parsing a subset of the</span>
<span class="sd">TeX math syntax and drawing them to a matplotlib backend.</span>

<span class="sd">For a tutorial of its usage see :ref:`sphx_glr_tutorials_text_mathtext.py`.  This</span>
<span class="sd">document is primarily concerned with implementation details.</span>

<span class="sd">The module uses pyparsing_ to parse the TeX expression.</span>

<span class="sd">.. _pyparsing: http://pyparsing.wikispaces.com/</span>

<span class="sd">The Bakoma distribution of the TeX Computer Modern fonts, and STIX</span>
<span class="sd">fonts are supported.  There is experimental support for using</span>
<span class="sd">arbitrary fonts, but results may vary without proper tweaking and</span>
<span class="sd">metrics for those fonts.</span>
<span class="sd">"""</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">unichr</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">ceil</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">inf</span><span class="p">,</span> <span class="n">isinf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">Combine</span><span class="p">,</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">FollowedBy</span><span class="p">,</span> <span class="n">Forward</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">oneOf</span><span class="p">,</span> <span class="n">OneOrMore</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span> <span class="n">ParseBaseException</span><span class="p">,</span> <span class="n">ParseFatalException</span><span class="p">,</span> <span class="n">ParserElement</span><span class="p">,</span>
    <span class="n">QuotedString</span><span class="p">,</span> <span class="n">Regex</span><span class="p">,</span> <span class="n">StringEnd</span><span class="p">,</span> <span class="n">Suppress</span><span class="p">,</span> <span class="n">ZeroOrMore</span><span class="p">)</span>

<span class="n">ParserElement</span><span class="o">.</span><span class="n">enablePackrat</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">_png</span><span class="p">,</span> <span class="n">colors</span> <span class="k">as</span> <span class="n">mcolors</span><span class="p">,</span> <span class="n">get_data_path</span><span class="p">,</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib.afm</span> <span class="k">import</span> <span class="n">AFM</span>
<span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="k">import</span> <span class="n">Bunch</span><span class="p">,</span> <span class="n">get_realpath_and_stat</span><span class="p">,</span> <span class="n">maxdict</span>
<span class="kn">from</span> <span class="nn">matplotlib.ft2font</span> <span class="k">import</span> <span class="n">FT2Image</span><span class="p">,</span> <span class="n">KERNING_DEFAULT</span><span class="p">,</span> <span class="n">LOAD_NO_HINTING</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="k">import</span> <span class="n">findfont</span><span class="p">,</span> <span class="n">FontProperties</span><span class="p">,</span> <span class="n">get_font</span>
<span class="kn">from</span> <span class="nn">matplotlib._mathtext_data</span> <span class="k">import</span> <span class="p">(</span><span class="n">latex_to_bakoma</span><span class="p">,</span> <span class="n">latex_to_standard</span><span class="p">,</span>
                                       <span class="n">tex2uni</span><span class="p">,</span> <span class="n">latex_to_cmex</span><span class="p">,</span>
                                       <span class="n">stix_virtual_fonts</span><span class="p">)</span>

<span class="c1">####################</span>



<span class="c1">##############################################################################</span>
<span class="c1"># FONTS</span>

<div class="viewcode-block" id="get_unicode_index"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.get_unicode_index">[docs]</a><span class="k">def</span> <span class="nf">get_unicode_index</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""get_unicode_index(symbol, [bool]) -&gt; integer</span>

<span class="sd">Return the integer index (from the Unicode table) of symbol.  *symbol*</span>
<span class="sd">can be a single unicode character, a TeX command (i.e. r'\\pi'), or a</span>
<span class="sd">Type1 symbol name (i.e. 'phi').</span>
<span class="sd">If math is False, the current symbol should be treated as a non-math symbol.</span>
<span class="sd">"""</span>
    <span class="c1"># for a non-math symbol, simply return its unicode index</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="c1"># From UTF #25: U+2212 minus sign is the preferred</span>
    <span class="c1"># representation of the unary and binary minus sign rather than</span>
    <span class="c1"># the ASCII-derived U+002D hyphen-minus, because minus sign is</span>
    <span class="c1"># unambiguous and because it is rendered with a more desirable</span>
    <span class="c1"># length, usually longer than a hyphen.</span>
    <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s1">'-'</span><span class="p">:</span>
        <span class="k">return</span> <span class="mh">0x2212</span>
    <span class="k">try</span><span class="p">:</span><span class="c1"># This will succeed if symbol is a single unicode char</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span><span class="c1"># Is symbol a TeX symbol (i.e. \alpha)</span>
        <span class="k">return</span> <span class="n">tex2uni</span><span class="p">[</span><span class="n">symbol</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">"""'</span><span class="si">%(symbol)s</span><span class="s2">' is not a valid Unicode character or</span>
<span class="s2">TeX/Type1 symbol"""</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="unichr_safe"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.unichr_safe">[docs]</a><span class="k">def</span> <span class="nf">unichr_safe</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">"""Return the Unicode character corresponding to the index,</span>
<span class="sd">or the replacement character if this is a narrow build of Python</span>
<span class="sd">and the requested character is outside the BMP."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unichr</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unichr</span><span class="p">(</span><span class="mh">0xFFFD</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackend"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackend</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The base class for the mathtext backend-specific code.  The</span>
<span class="sd">    purpose of :class:`MathtextBackend` subclasses is to interface</span>
<span class="sd">    between mathtext and a specific matplotlib graphics backend.</span>

<span class="sd">    Subclasses need to override the following:</span>

<span class="sd">      - :meth:`render_glyph`</span>
<span class="sd">      - :meth:`render_rect_filled`</span>
<span class="sd">      - :meth:`get_results`</span>

<span class="sd">    And optionally, if you need to use a FreeType hinting style:</span>

<span class="sd">      - :meth:`get_hinting_type`</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="MathtextBackend.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="s1">'Dimension the drawing canvas'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">=</span> <span class="n">d</span></div>

<div class="viewcode-block" id="MathtextBackend.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Draw a glyph described by *info* to the reference point (*ox*,</span>
<span class="sd">        *oy*).</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Draw a filled black rectangle from (*x1*, *y1*) to (*x2*, *y2*).</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a backend-specific tuple to return to the backend after</span>
<span class="sd">        all processing is done.</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.get_hinting_type"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.get_hinting_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_hinting_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the FreeType hinting type to use with this particular</span>
<span class="sd">        backend.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">LOAD_NO_HINTING</span></div></div>

<div class="viewcode-block" id="MathtextBackendAgg"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendAgg</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Render glyphs and rectangles to an FTImage buffer, which is later</span>
<span class="sd">    transferred to the Agg image by the Agg backend.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ox</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">'bbox'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">MathtextBackend</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">),</span>
                     <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y1</span><span class="p">),</span>
                     <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x2</span><span class="p">),</span>
                     <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">y2</span><span class="p">)]</span>

<div class="viewcode-block" id="MathtextBackendAgg.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">MathtextBackend</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">'bbox'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">FT2Image</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'bbox'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_bbox</span><span class="p">(</span><span class="n">ox</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
                              <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
                              <span class="n">ox</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                              <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">draw_glyph_to_bitmap</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">glyph</span><span class="p">,</span>
                <span class="n">antialiased</span><span class="o">=</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'text.antialiased'</span><span class="p">])</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'bbox'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_bbox</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">draw_rect_filled</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">'bbox'</span>
        <span class="n">orig_height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">orig_depth</span>  <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">'render'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span>
            <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">orig_depth</span><span class="p">,</span>
            <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">orig_height</span><span class="p">)</span>
        <span class="n">ship</span><span class="p">(</span><span class="o">-</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                  <span class="n">used_characters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.get_hinting_type"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.get_hinting_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_hinting_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="k">import</span> <span class="n">backend_agg</span>
        <span class="k">return</span> <span class="n">backend_agg</span><span class="o">.</span><span class="n">get_hinting_flag</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="MathtextBackendBitmap"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendBitmap">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendBitmap</span><span class="p">(</span><span class="n">MathtextBackendAgg</span><span class="p">):</span>
<div class="viewcode-block" id="MathtextBackendBitmap.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendBitmap.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">characters</span> <span class="o">=</span> \
            <span class="n">MathtextBackendAgg</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">depth</span></div></div>

<div class="viewcode-block" id="MathtextBackendPs"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPs</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Store information to write a mathtext rendering to the PostScript</span>
<span class="sd">    backend.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">cStringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MathtextBackendPs.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">postscript_name</span>
        <span class="n">fontsize</span>        <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span>
        <span class="n">symbol_name</span>     <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">symbol_name</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">postscript_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="s2">"""/</span><span class="si">%(postscript_name)s</span><span class="s2"> findfont</span>
<span class="si">%(fontsize)s</span><span class="s2"> scalefont</span>
<span class="s2">setfont</span>
<span class="s2">"""</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span> <span class="o">=</span> <span class="n">postscript_name</span><span class="p">,</span> <span class="n">fontsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>

        <span class="n">ps</span> <span class="o">=</span> <span class="s2">"""</span><span class="si">%(ox)f</span><span class="s2"> </span><span class="si">%(oy)f</span><span class="s2"> moveto</span>
<span class="s2">/</span><span class="si">%(symbol_name)s</span><span class="s2"> glyphshow</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">"""</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendPs.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> rectfill</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendPs.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="p">,</span>
                <span class="n">used_characters</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="MathtextBackendPdf"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPdf</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Store information to write a mathtext rendering to the PDF</span>
<span class="sd">    backend.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendPdf.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
             <span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">symbol_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPdf.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPdf.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">,</span>
                <span class="n">used_characters</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="MathtextBackendSvg"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendSvg</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Store information to write a mathtext rendering to the SVG</span>
<span class="sd">    backend.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendSvg.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendSvg.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendSvg.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">svg_elements</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">svg_glyphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span><span class="p">,</span>
                             <span class="n">svg_rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="n">svg_elements</span><span class="p">,</span>
                <span class="n">used_characters</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="MathtextBackendPath"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPath</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Store information to write a mathtext rendering to the text path</span>
<span class="sd">    machinery.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendPath.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">thetext</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">thetext</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPath.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="n">y2</span> <span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPath.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="MathtextBackendCairo"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendCairo</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Store information to write a mathtext rendering to the Cairo</span>
<span class="sd">    backend.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendCairo.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">thetext</span> <span class="o">=</span> <span class="n">unichr_safe</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">thetext</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendCairo.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendCairo.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Fonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts">[docs]</a><span class="k">class</span> <span class="nc">Fonts</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    An abstract base class for a system of fonts to use for mathtext.</span>

<span class="sd">    The class must be able to take symbol keys and font file names and</span>
<span class="sd">    return the character metrics.  It also delegates to a backend class</span>
<span class="sd">    to do the actual drawing.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        *default_font_prop*: A</span>
<span class="sd">        :class:`~matplotlib.font_manager.FontProperties` object to use</span>
<span class="sd">        for the default non-math font, or the base font for Unicode</span>
<span class="sd">        (generic) font rendering.</span>

<span class="sd">        *mathtext_backend*: A subclass of :class:`MathTextBackend`</span>
<span class="sd">        used to delegate the actual rendering.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_font_prop</span> <span class="o">=</span> <span class="n">default_font_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span> <span class="o">=</span> <span class="n">mathtext_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Fonts.destroy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Fix any cyclical references before the object is about</span>
<span class="sd">        to be destroyed.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Fonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the kerning distance for font between *sym1* and *sym2*.</span>

<span class="sd">        *fontX*: one of the TeX font names::</span>

<span class="sd">          tt, it, rm, cal, sf, bf or default/regular (non-math)</span>

<span class="sd">        *fontclassX*: TODO</span>

<span class="sd">        *symX*: a symbol in raw TeX form. e.g., '1', 'x' or '\\sigma'</span>

<span class="sd">        *fontsizeX*: the fontsize in points</span>

<span class="sd">        *dpi*: the current dots-per-inch</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="mf">0.</span></div>

<div class="viewcode-block" id="Fonts.get_metrics"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        *font*: one of the TeX font names::</span>

<span class="sd">          tt, it, rm, cal, sf, bf or default/regular (non-math)</span>

<span class="sd">        *font_class*: TODO</span>

<span class="sd">        *sym*:  a symbol in raw TeX form. e.g., '1', 'x' or '\\sigma'</span>

<span class="sd">        *fontsize*: font size in points</span>

<span class="sd">        *dpi*: current dots-per-inch</span>

<span class="sd">        *math*: whether sym is a math character</span>

<span class="sd">        Returns an object with the following attributes:</span>

<span class="sd">          - *advance*: The advance distance (in points) of the glyph.</span>

<span class="sd">          - *height*: The height of the glyph in points.</span>

<span class="sd">          - *width*: The width of the glyph in points.</span>

<span class="sd">          - *xmin*, *xmax*, *ymin*, *ymax* - the ink rectangle of the glyph</span>

<span class="sd">          - *iceberg* - the distance from the baseline to the top of</span>
<span class="sd">            the glyph.  This corresponds to TeX's definition of</span>
<span class="sd">            "height".</span>
<span class="sd">        """</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span></div>

<div class="viewcode-block" id="Fonts.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set the size of the buffer used to render the math expression.</span>
<span class="sd">        Only really necessary for the bitmap backends.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">facename</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Draw a glyph at</span>

<span class="sd">          - *ox*, *oy*: position</span>

<span class="sd">          - *facename*: One of the TeX face names</span>

<span class="sd">          - *font_class*:</span>

<span class="sd">          - *sym*: TeX symbol name or single character</span>

<span class="sd">          - *fontsize*: fontsize in points</span>

<span class="sd">          - *dpi*: The dpi to draw at.</span>
<span class="sd">        """</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">facename</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">realpath</span><span class="p">,</span> <span class="n">stat_key</span> <span class="o">=</span> <span class="n">get_realpath_and_stat</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">used_characters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
            <span class="n">stat_key</span><span class="p">,</span> <span class="p">(</span><span class="n">realpath</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span>
        <span class="n">used_characters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Draw a filled rectangle from (*x1*, *y1*) to (*x2*, *y2*).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">render_rect_filled</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the xheight for the given *font* and *fontsize*.</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the line thickness that matches the given font.  Used as a</span>
<span class="sd">        base unit for drawing lines such as in a fraction or radical.</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fonts.get_used_characters"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_used_characters">[docs]</a>    <span class="k">def</span> <span class="nf">get_used_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the set of characters that were used in the math</span>
<span class="sd">        expression.  Used by backends that need to subset fonts so</span>
<span class="sd">        they know which glyphs to include.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span></div>

<div class="viewcode-block" id="Fonts.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the data needed by the backend to render the math</span>
<span class="sd">        expression.  The return value is backend-specific.</span>
<span class="sd">        """</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_used_characters</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Fonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Override if your font provides multiple sizes of the same</span>
<span class="sd">        symbol.  Should return a list of symbols matching *sym* in</span>
<span class="sd">        various sizes.  The expression renderer will select the most</span>
<span class="sd">        appropriate size for a given situation from this list.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span></div></div>

<div class="viewcode-block" id="TruetypeFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts">[docs]</a><span class="k">class</span> <span class="nc">TruetypeFonts</span><span class="p">(</span><span class="n">Fonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A generic base class for all font setups that use Truetype fonts</span>
<span class="sd">    (through FT2Font).</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">):</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">default_font_prop</span><span class="p">)</span>
        <span class="n">default_font</span> <span class="o">=</span> <span class="n">get_font</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="s1">'default'</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="s1">'regular'</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>

<div class="viewcode-block" id="TruetypeFonts.destroy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">cached_font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_font</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
            <span class="n">cached_font</span> <span class="o">=</span> <span class="n">get_font</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">postscript_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">postscript_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">cached_font</span>
        <span class="k">return</span> <span class="n">cached_font</span>

    <span class="k">def</span> <span class="nf">_get_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">postscript_name</span> <span class="o">==</span> <span class="s1">'Cmex10'</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">glyph</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mf">64.0</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fontsize</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">dpi</span><span class="o">/</span><span class="mf">72.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">_get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span>
        <span class="n">bunch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bunch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bunch</span>

        <span class="n">font</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>

        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">glyph</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">load_char</span><span class="p">(</span>
            <span class="n">num</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">get_hinting_type</span><span class="p">())</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">/</span><span class="mf">64.0</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">glyph</span><span class="o">.</span><span class="n">bbox</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span>
            <span class="n">advance</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">linearHoriAdvance</span><span class="o">/</span><span class="mf">65536.0</span><span class="p">,</span>
            <span class="n">height</span>  <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mf">64.0</span><span class="p">,</span>
            <span class="n">width</span>   <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mf">64.0</span><span class="p">,</span>
            <span class="n">xmin</span>    <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
            <span class="n">xmax</span>    <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
            <span class="n">ymin</span>    <span class="o">=</span> <span class="n">ymin</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="n">ymax</span>    <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="c1"># iceberg is the equivalent of TeX's "height"</span>
            <span class="n">iceberg</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">horiBearingY</span><span class="o">/</span><span class="mf">64.0</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="n">slanted</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span>
            <span class="n">font</span>            <span class="o">=</span> <span class="n">font</span><span class="p">,</span>
            <span class="n">fontsize</span>        <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span>
            <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">postscript_name</span><span class="p">,</span>
            <span class="n">metrics</span>         <span class="o">=</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="n">symbol_name</span>     <span class="o">=</span> <span class="n">symbol_name</span><span class="p">,</span>
            <span class="n">num</span>             <span class="o">=</span> <span class="n">num</span><span class="p">,</span>
            <span class="n">glyph</span>           <span class="o">=</span> <span class="n">glyph</span><span class="p">,</span>
            <span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="TruetypeFonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">pclt</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_sfnt_table</span><span class="p">(</span><span class="s1">'pclt'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pclt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Some fonts don't store the xHeight, so we do a poor man's xHeight</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.default'</span><span class="p">],</span> <span class="s1">'x'</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span>
        <span class="n">xHeight</span> <span class="o">=</span> <span class="p">(</span><span class="n">pclt</span><span class="p">[</span><span class="s1">'xHeight'</span><span class="p">]</span> <span class="o">/</span> <span class="mf">64.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dpi</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xHeight</span></div>

<div class="viewcode-block" id="TruetypeFonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="c1"># This function used to grab underline thickness from the font</span>
        <span class="c1"># metrics, but that information is just too un-reliable, so it</span>
        <span class="c1"># is now hardcoded.</span>
        <span class="k">return</span> <span class="p">((</span><span class="mf">0.75</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">fontsize</span> <span class="o">*</span> <span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">72.0</span></div>

<div class="viewcode-block" id="TruetypeFonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font1</span> <span class="o">==</span> <span class="n">font2</span> <span class="ow">and</span> <span class="n">fontsize1</span> <span class="o">==</span> <span class="n">fontsize2</span><span class="p">:</span>
            <span class="n">info1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">info2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">info1</span><span class="o">.</span><span class="n">font</span>
            <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_kerning</span><span class="p">(</span><span class="n">info1</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">info2</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">KERNING_DEFAULT</span><span class="p">)</span> <span class="o">/</span> <span class="mf">64.0</span>
        <span class="k">return</span> <span class="n">Fonts</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                              <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="BakomaFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.BakomaFonts">[docs]</a><span class="k">class</span> <span class="nc">BakomaFonts</span><span class="p">(</span><span class="n">TruetypeFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Use the Bakoma TrueType fonts for rendering.</span>

<span class="sd">    Symbols are strewn about a number of font files, each of which has</span>
<span class="sd">    its own proprietary 8-bit encoding.</span>
<span class="sd">    """</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'cal'</span> <span class="p">:</span> <span class="s1">'cmsy10'</span><span class="p">,</span>
                 <span class="s1">'rm'</span>  <span class="p">:</span> <span class="s1">'cmr10'</span><span class="p">,</span>
                 <span class="s1">'tt'</span>  <span class="p">:</span> <span class="s1">'cmtt10'</span><span class="p">,</span>
                 <span class="s1">'it'</span>  <span class="p">:</span> <span class="s1">'cmmi10'</span><span class="p">,</span>
                 <span class="s1">'bf'</span>  <span class="p">:</span> <span class="s1">'cmb10'</span><span class="p">,</span>
                 <span class="s1">'sf'</span>  <span class="p">:</span> <span class="s1">'cmss10'</span><span class="p">,</span>
                 <span class="s1">'ex'</span>  <span class="p">:</span> <span class="s1">'cmex10'</span>
                 <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stix_fallback</span> <span class="o">=</span> <span class="n">StixFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="p">):</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>


    <span class="n">_slanted_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\int \oint"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">symbol_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">font</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fontname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="ow">and</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">latex_to_bakoma</span><span class="p">:</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">latex_to_bakoma</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">basename</span> <span class="o">==</span> <span class="s2">"cmmi10"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slanted_symbols</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s2">"it"</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_glyph_name</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stix_fallback</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">font</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span>

    <span class="c1"># The Bakoma fonts contain many pre-sized alternatives for the</span>
    <span class="c1"># delimiters.  The AutoSizedChar class will use these alternatives</span>
    <span class="c1"># and select the best (closest sized) glyph.</span>
    <span class="n">_size_alternatives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'('</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'('</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa1</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb3</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb5</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xc3</span><span class="s1">'</span><span class="p">)],</span>
        <span class="s1">')'</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">')'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa2</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb4</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb6</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x21</span><span class="s1">'</span><span class="p">)],</span>
        <span class="s1">'{'</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'{'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa9</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6e</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xbd</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x28</span><span class="s1">'</span><span class="p">)],</span>
        <span class="s1">'}'</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'}'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xaa</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6f</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xbe</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x29</span><span class="s1">'</span><span class="p">)],</span>
        <span class="c1"># The fourth size of '[' is mysteriously missing from the BaKoMa</span>
        <span class="c1"># font, so I've omitted it for both '[' and ']'</span>
        <span class="s1">'['</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'['</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa3</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x68</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x22</span><span class="s1">'</span><span class="p">)],</span>
        <span class="s1">']'</span>          <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">']'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa4</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x69</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x23</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\lfloor'</span>   <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa5</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6a</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb9</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x24</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\rfloor'</span>   <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa6</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6b</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xba</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x25</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\lceil'</span>    <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa7</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6c</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xbb</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x26</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\rceil'</span>    <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xa8</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x6d</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xbc</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x27</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\langle'</span>   <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xad</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x44</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xbf</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2a</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\rangle'</span>   <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xae</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x45</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xc0</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2b</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\__sqrt__'</span> <span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x70</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x71</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x72</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x73</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\backslash'</span><span class="p">:</span> <span class="p">[(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb2</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2f</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xc2</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2d</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'/'</span>         <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xb1</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2e</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\xcb</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x2c</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\widehat'</span>  <span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x5e</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x62</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x63</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x64</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'\widetilde'</span><span class="p">:</span> <span class="p">[(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x7e</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x65</span><span class="s1">'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x66</span><span class="s1">'</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\x67</span><span class="s1">'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'&lt;'</span>         <span class="p">:</span> <span class="p">[(</span><span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'h'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'D'</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">'&gt;'</span>         <span class="p">:</span> <span class="p">[(</span><span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span> <span class="s1">'E'</span><span class="p">)]</span>
        <span class="p">}</span>

    <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">'\leftparen'</span><span class="p">,</span> <span class="s1">'('</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\rightparent'</span><span class="p">,</span> <span class="s1">')'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\leftbrace'</span><span class="p">,</span> <span class="s1">'{'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\rightbrace'</span><span class="p">,</span> <span class="s1">'}'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\leftbracket'</span><span class="p">,</span> <span class="s1">'['</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\rightbracket'</span><span class="p">,</span> <span class="s1">']'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\{'</span><span class="p">,</span> <span class="s1">'{'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\}'</span><span class="p">,</span> <span class="s1">'}'</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\['</span><span class="p">,</span> <span class="s1">'['</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">'\]'</span><span class="p">,</span> <span class="s1">']'</span><span class="p">)]:</span>
        <span class="n">_size_alternatives</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">_size_alternatives</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>

<div class="viewcode-block" id="BakomaFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.BakomaFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size_alternatives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)])</span></div></div>

<div class="viewcode-block" id="UnicodeFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.UnicodeFonts">[docs]</a><span class="k">class</span> <span class="nc">UnicodeFonts</span><span class="p">(</span><span class="n">TruetypeFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    An abstract base class for handling Unicode fonts.</span>

<span class="sd">    While some reasonably complete Unicode fonts (such as DejaVu) may</span>
<span class="sd">    work in some situations, the only Unicode font I'm aware of with a</span>
<span class="sd">    complete set of math symbols is STIX.</span>

<span class="sd">    This class will "fallback" on the Bakoma fonts when a required</span>
<span class="sd">    symbol can not be found in the font.</span>
<span class="sd">    """</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This must come first so the backend's owner is set correctly</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.fallback_to_cm'</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">BakomaFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">texfont</span> <span class="ow">in</span> <span class="s2">"cal rm tt it bf sf"</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.'</span> <span class="o">+</span> <span class="n">texfont</span><span class="p">]</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">texfont</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="s1">'cmex10'</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="s1">'ex'</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>

    <span class="n">_slanted_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\int \oint"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_map_virtual_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cmex</span><span class="p">:</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">latex_to_cmex</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uniindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="s1">'ex'</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">'?'</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">"No TeX to unicode mapping for '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span>
                     <span class="n">sym</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">,</span> <span class="s1">'backslashreplace'</span><span class="p">),</span>
                     <span class="n">MathTextWarning</span><span class="p">)</span>

        <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_virtual_font</span><span class="p">(</span>
            <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">)</span>

        <span class="n">new_fontname</span> <span class="o">=</span> <span class="n">fontname</span>

        <span class="c1"># Only characters in the "Letter" class should be italicized in 'it'</span>
        <span class="c1"># mode.  Greek capital letters should be Roman.</span>
        <span class="k">if</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fontname</span> <span class="o">==</span> <span class="s1">'it'</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">uniindex</span> <span class="o">&lt;</span> <span class="mh">0x10000</span><span class="p">:</span>
                    <span class="n">unistring</span> <span class="o">=</span> <span class="n">unichr</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">unistring</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"L"</span>
                        <span class="ow">or</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">unistring</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"GREEK CAPITAL"</span><span class="p">)):</span>
                        <span class="n">new_fontname</span> <span class="o">=</span> <span class="s1">'rm'</span>

            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_fontname</span> <span class="o">==</span> <span class="s1">'it'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slanted_symbols</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">new_fontname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glyphindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">,</span> <span class="n">BakomaFonts</span><span class="p">):</span>
                    <span class="n">warn</span><span class="p">(</span><span class="s2">"Substituting with a symbol from Computer Modern."</span><span class="p">,</span>
                         <span class="n">MathTextWarning</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'it'</span><span class="p">,</span> <span class="s1">'regular'</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">,</span> <span class="n">StixFonts</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                            <span class="s1">'rm'</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                        <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'it'</span><span class="p">,</span> <span class="s1">'regular'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">StixFonts</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">"Font '</span><span class="si">%s</span><span class="s2">' does not have a glyph for '</span><span class="si">%s</span><span class="s2">' [U+</span><span class="si">%x</span><span class="s2">]"</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">new_fontname</span><span class="p">,</span>
                      <span class="n">sym</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">,</span> <span class="s1">'backslashreplace'</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">),</span>
                      <span class="n">uniindex</span><span class="p">),</span>
                     <span class="n">MathTextWarning</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">"Substituting with a dummy symbol."</span><span class="p">,</span> <span class="n">MathTextWarning</span><span class="p">)</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="s1">'rm'</span>
                <span class="n">new_fontname</span> <span class="o">=</span> <span class="n">fontname</span>
                <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="mh">0xA4</span> <span class="c1"># currency character, for lack of anything better</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="n">slanted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_glyph_name</span><span class="p">(</span><span class="n">glyphindex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span>

<div class="viewcode-block" id="UnicodeFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.UnicodeFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="DejaVuFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuFonts</span><span class="p">(</span><span class="n">UnicodeFonts</span><span class="p">):</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This must come first so the backend's owner is set correctly</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DejaVuSerifFonts</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">StixFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">StixSansFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bakoma</span> <span class="o">=</span> <span class="n">BakomaFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Include Stix sized alternatives for glyphs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                 <span class="mi">1</span> <span class="p">:</span> <span class="s1">'STIXSizeOneSym'</span><span class="p">,</span>
                 <span class="mi">2</span> <span class="p">:</span> <span class="s1">'STIXSizeTwoSym'</span><span class="p">,</span>
                 <span class="mi">3</span> <span class="p">:</span> <span class="s1">'STIXSizeThreeSym'</span><span class="p">,</span>
                 <span class="mi">4</span> <span class="p">:</span> <span class="s1">'STIXSizeFourSym'</span><span class="p">,</span>
                 <span class="mi">5</span> <span class="p">:</span> <span class="s1">'STIXSizeFiveSym'</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="p">):</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">""" Override prime symbol to use Bakoma """</span>
        <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">'\prime'</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bakoma</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span>
                    <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check whether the glyph is available in the display font</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="s1">'ex'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glyphindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="s1">'ex'</span><span class="p">,</span>
                            <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
            <span class="c1"># otherwise return regular glyph</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span>
                    <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span></div>


<div class="viewcode-block" id="DejaVuSerifFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSerifFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSerifFonts</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A font handling class for the DejaVu Serif fonts</span>

<span class="sd">    If a glyph is not found it will fallback to Stix Serif</span>
<span class="sd">    """</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'rm'</span>  <span class="p">:</span> <span class="s1">'DejaVu Serif'</span><span class="p">,</span>
                 <span class="s1">'it'</span>  <span class="p">:</span> <span class="s1">'DejaVu Serif:italic'</span><span class="p">,</span>
                 <span class="s1">'bf'</span>  <span class="p">:</span> <span class="s1">'DejaVu Serif:weight=bold'</span><span class="p">,</span>
                 <span class="s1">'sf'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans'</span><span class="p">,</span>
                 <span class="s1">'tt'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans Mono'</span><span class="p">,</span>
                 <span class="s1">'ex'</span>  <span class="p">:</span> <span class="s1">'DejaVu Serif Display'</span><span class="p">,</span>
                 <span class="mi">0</span>     <span class="p">:</span> <span class="s1">'DejaVu Serif'</span><span class="p">,</span>
                 <span class="p">}</span></div>

<div class="viewcode-block" id="DejaVuSansFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSansFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSansFonts</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A font handling class for the DejaVu Sans fonts</span>

<span class="sd">    If a glyph is not found it will fallback to Stix Sans</span>
<span class="sd">    """</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'rm'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans'</span><span class="p">,</span>
                 <span class="s1">'it'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans:italic'</span><span class="p">,</span>
                 <span class="s1">'bf'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans:weight=bold'</span><span class="p">,</span>
                 <span class="s1">'sf'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans'</span><span class="p">,</span>
                 <span class="s1">'tt'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans Mono'</span><span class="p">,</span>
                 <span class="s1">'ex'</span>  <span class="p">:</span> <span class="s1">'DejaVu Sans Display'</span><span class="p">,</span>
                 <span class="mi">0</span>     <span class="p">:</span> <span class="s1">'DejaVu Sans'</span><span class="p">,</span>
                 <span class="p">}</span></div>

<div class="viewcode-block" id="StixFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixFonts">[docs]</a><span class="k">class</span> <span class="nc">StixFonts</span><span class="p">(</span><span class="n">UnicodeFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A font handling class for the STIX fonts.</span>

<span class="sd">    In addition to what UnicodeFonts provides, this class:</span>

<span class="sd">    - supports "virtual fonts" which are complete alpha numeric</span>
<span class="sd">      character sets with different font styles at special Unicode</span>
<span class="sd">      code points, such as "Blackboard".</span>

<span class="sd">    - handles sized alternative characters for the STIXSizeX fonts.</span>
<span class="sd">    """</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'rm'</span>  <span class="p">:</span> <span class="s1">'STIXGeneral'</span><span class="p">,</span>
                 <span class="s1">'it'</span>  <span class="p">:</span> <span class="s1">'STIXGeneral:italic'</span><span class="p">,</span>
                 <span class="s1">'bf'</span>  <span class="p">:</span> <span class="s1">'STIXGeneral:weight=bold'</span><span class="p">,</span>
                 <span class="s1">'nonunirm'</span> <span class="p">:</span> <span class="s1">'STIXNonUnicode'</span><span class="p">,</span>
                 <span class="s1">'nonuniit'</span> <span class="p">:</span> <span class="s1">'STIXNonUnicode:italic'</span><span class="p">,</span>
                 <span class="s1">'nonunibf'</span> <span class="p">:</span> <span class="s1">'STIXNonUnicode:weight=bold'</span><span class="p">,</span>

                 <span class="mi">0</span> <span class="p">:</span> <span class="s1">'STIXGeneral'</span><span class="p">,</span>
                 <span class="mi">1</span> <span class="p">:</span> <span class="s1">'STIXSizeOneSym'</span><span class="p">,</span>
                 <span class="mi">2</span> <span class="p">:</span> <span class="s1">'STIXSizeTwoSym'</span><span class="p">,</span>
                 <span class="mi">3</span> <span class="p">:</span> <span class="s1">'STIXSizeThreeSym'</span><span class="p">,</span>
                 <span class="mi">4</span> <span class="p">:</span> <span class="s1">'STIXSizeFourSym'</span><span class="p">,</span>
                 <span class="mi">5</span> <span class="p">:</span> <span class="s1">'STIXSizeFiveSym'</span>
                 <span class="p">}</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cm_fallback</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_sans</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="p">):</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="k">def</span> <span class="nf">_map_virtual_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">):</span>
        <span class="c1"># Handle these "fonts" that are actually embedded in</span>
        <span class="c1"># other fonts.</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">stix_virtual_fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sans</span> <span class="ow">and</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="n">fontname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'regular'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">)):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">stix_virtual_fonts</span><span class="p">[</span><span class="s1">'sf'</span><span class="p">]</span>
            <span class="n">doing_sans_conversion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doing_sans_conversion</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">font_class</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">'rm'</span><span class="p">]</span>

            <span class="c1"># Binary search for the source glyph</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span><span class="o">+</span><span class="n">hi</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">uniindex</span> <span class="o">&lt;</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
                <span class="k">elif</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">uniindex</span> <span class="o">&gt;=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="n">uniindex</span> <span class="o">-</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">range</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">doing_sans_conversion</span><span class="p">:</span>
                <span class="c1"># This will generate a dummy character</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="mh">0x1</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.default'</span><span class="p">]</span>

        <span class="c1"># Handle private use area glyphs</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'it'</span><span class="p">,</span> <span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'bf'</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">uniindex</span> <span class="o">&gt;=</span> <span class="mh">0xe000</span> <span class="ow">and</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="mh">0xf8ff</span><span class="p">):</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="s1">'nonuni'</span> <span class="o">+</span> <span class="n">fontname</span>

        <span class="k">return</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span>

    <span class="n">_size_alternatives</span> <span class="o">=</span> <span class="p">{}</span>
<div class="viewcode-block" id="StixFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="n">fixes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'</span><span class="se">\\</span><span class="s1">{'</span><span class="p">:</span> <span class="s1">'{'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">}'</span><span class="p">:</span> <span class="s1">'}'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">['</span><span class="p">:</span> <span class="s1">'['</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">]'</span><span class="p">:</span> <span class="s1">']'</span><span class="p">}</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">fixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>

        <span class="n">alternatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size_alternatives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">alternatives</span>

        <span class="n">alternatives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span>

        <span class="n">fix_ups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s1">'&lt;'</span><span class="p">):</span> <span class="mh">0x27e8</span><span class="p">,</span>
            <span class="nb">ord</span><span class="p">(</span><span class="s1">'&gt;'</span><span class="p">):</span> <span class="mh">0x27e9</span> <span class="p">}</span>

        <span class="n">uniindex</span> <span class="o">=</span> <span class="n">fix_ups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uniindex</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glyphindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">alternatives</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">unichr_safe</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)))</span>

        <span class="c1"># The largest size of the radical symbol in STIX has incorrect</span>
        <span class="c1"># metrics that cause it to be disconnected from the stem.</span>
        <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">'\__sqrt__'</span><span class="p">:</span>
            <span class="n">alternatives</span> <span class="o">=</span> <span class="n">alternatives</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_size_alternatives</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">alternatives</span>
        <span class="k">return</span> <span class="n">alternatives</span></div></div>

<div class="viewcode-block" id="StixSansFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixSansFonts">[docs]</a><span class="k">class</span> <span class="nc">StixSansFonts</span><span class="p">(</span><span class="n">StixFonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A font handling class for the STIX fonts (that uses sans-serif</span>
<span class="sd">    characters by default).</span>
<span class="sd">    """</span>
    <span class="n">_sans</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="StandardPsFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts">[docs]</a><span class="k">class</span> <span class="nc">StandardPsFonts</span><span class="p">(</span><span class="n">Fonts</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Use the standard postscript fonts for rendering to backend_ps</span>

<span class="sd">    Unlike the other font classes, BakomaFont and UnicodeFont, this</span>
<span class="sd">    one requires the Ps backend.</span>
<span class="sd">    """</span>
    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">get_data_path</span><span class="p">(),</span> <span class="s1">'fonts'</span><span class="p">,</span> <span class="s1">'afm'</span> <span class="p">)</span>

    <span class="n">fontmap</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'cal'</span> <span class="p">:</span> <span class="s1">'pzcmi8a'</span><span class="p">,</span>  <span class="c1"># Zapf Chancery</span>
                <span class="s1">'rm'</span>  <span class="p">:</span> <span class="s1">'pncr8a'</span><span class="p">,</span>   <span class="c1"># New Century Schoolbook</span>
                <span class="s1">'tt'</span>  <span class="p">:</span> <span class="s1">'pcrr8a'</span><span class="p">,</span>   <span class="c1"># Courier</span>
                <span class="s1">'it'</span>  <span class="p">:</span> <span class="s1">'pncri8a'</span><span class="p">,</span>  <span class="c1"># New Century Schoolbook Italic</span>
                <span class="s1">'sf'</span>  <span class="p">:</span> <span class="s1">'phvr8a'</span><span class="p">,</span>   <span class="c1"># Helvetica</span>
                <span class="s1">'bf'</span>  <span class="p">:</span> <span class="s1">'pncb8a'</span><span class="p">,</span>   <span class="c1"># New Century Schoolbook Bold</span>
                <span class="kc">None</span>  <span class="p">:</span> <span class="s1">'psyr'</span>      <span class="c1"># Symbol</span>
                <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">):</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">MathtextBackendPs</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">default_font_prop</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">'afm'</span><span class="p">,</span>
                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="s1">'Helvetica'</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">'afm'</span><span class="p">,</span>
                                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">default_font</span> <span class="o">=</span> <span class="n">AFM</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">default_font</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="s1">'default'</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="s1">'regular'</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">cStringIO</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">font</span>

        <span class="n">cached_font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_font</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">,</span> <span class="n">basename</span> <span class="o">+</span> <span class="s2">".afm"</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">cached_font</span> <span class="o">=</span> <span class="n">AFM</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">cached_font</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">()]</span> <span class="o">=</span> <span class="n">cached_font</span>
        <span class="k">return</span> <span class="n">cached_font</span>

    <span class="k">def</span> <span class="nf">_get_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="s1">'load the cmfont, metrics and glyph with caching'</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span>
        <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tup</span>

        <span class="c1"># Only characters in the "Letter" class should really be italicized.</span>
        <span class="c1"># This class includes greek letters, so we're ok</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s1">'it'</span> <span class="ow">and</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span>
             <span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"L"</span><span class="p">))):</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="s1">'rm'</span>

        <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">latex_to_standard</span><span class="p">:</span>
            <span class="n">fontname</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">latex_to_standard</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="n">sym</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">"No TeX to built-in Postscript mapping for </span><span class="si">{!r}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sym</span><span class="p">),</span>
                 <span class="n">MathTextWarning</span><span class="p">)</span>

        <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s1">'it'</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_name_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">"No glyph in standard Postscript font </span><span class="si">{!r}</span><span class="s2"> for </span><span class="si">{!r}</span><span class="s2">"</span>
                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">(),</span> <span class="n">sym</span><span class="p">),</span> <span class="n">MathTextWarning</span><span class="p">)</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="n">sym</span> <span class="o">=</span> <span class="s1">'?'</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_name_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">*</span> <span class="n">scale</span>
                                  <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">font</span><span class="o">.</span><span class="n">get_bbox_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)]</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span>
            <span class="n">advance</span>  <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">width</span>    <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">height</span>   <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_height_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="c1"># iceberg is the equivalent of TeX's "height"</span>
            <span class="n">iceberg</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="n">slanted</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span>
            <span class="n">font</span>            <span class="o">=</span> <span class="n">font</span><span class="p">,</span>
            <span class="n">fontsize</span>        <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span>
            <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">(),</span>
            <span class="n">metrics</span>         <span class="o">=</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="n">symbol_name</span>     <span class="o">=</span> <span class="n">symbol_name</span><span class="p">,</span>
            <span class="n">num</span>             <span class="o">=</span> <span class="n">num</span><span class="p">,</span>
            <span class="n">glyph</span>           <span class="o">=</span> <span class="n">glyph</span><span class="p">,</span>
            <span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<div class="viewcode-block" id="StandardPsFonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font1</span> <span class="o">==</span> <span class="n">font2</span> <span class="ow">and</span> <span class="n">fontsize1</span> <span class="o">==</span> <span class="n">fontsize2</span><span class="p">:</span>
            <span class="n">info1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">info2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">info1</span><span class="o">.</span><span class="n">font</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">get_kern_dist</span><span class="p">(</span><span class="n">info1</span><span class="o">.</span><span class="n">glyph</span><span class="p">,</span> <span class="n">info2</span><span class="o">.</span><span class="n">glyph</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Fonts</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                              <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span></div>

<div class="viewcode-block" id="StandardPsFonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span></div>

<div class="viewcode-block" id="StandardPsFonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span></div></div>


<span class="c1">##############################################################################</span>
<span class="c1"># TeX-LIKE BOX MODEL</span>

<span class="c1"># The following is based directly on the document 'woven' from the</span>
<span class="c1"># TeX82 source code.  This information is also available in printed</span>
<span class="c1"># form:</span>
<span class="c1">#</span>
<span class="c1">#    Knuth, Donald E.. 1986.  Computers and Typesetting, Volume B:</span>
<span class="c1">#    TeX: The Program.  Addison-Wesley Professional.</span>
<span class="c1">#</span>
<span class="c1"># The most relevant "chapters" are:</span>
<span class="c1">#    Data structures for boxes and their friends</span>
<span class="c1">#    Shipping pages out (Ship class)</span>
<span class="c1">#    Packaging (hpack and vpack)</span>
<span class="c1">#    Data structures for math mode</span>
<span class="c1">#    Subroutines for math mode</span>
<span class="c1">#    Typesetting math formulas</span>
<span class="c1">#</span>
<span class="c1"># Many of the docstrings below refer to a numbered "node" in that</span>
<span class="c1"># book, e.g., node123</span>
<span class="c1">#</span>
<span class="c1"># Note that (as TeX) y increases downward, unlike many other parts of</span>
<span class="c1"># matplotlib.</span>

<span class="c1"># How much text shrinks when going to the next-smallest level.  GROW_FACTOR</span>
<span class="c1"># must be the inverse of SHRINK_FACTOR.</span>
<span class="n">SHRINK_FACTOR</span>   <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">GROW_FACTOR</span>     <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">SHRINK_FACTOR</span>
<span class="c1"># The number of different sizes of chars to use, beyond which they will not</span>
<span class="c1"># get any smaller</span>
<span class="n">NUM_SIZE_LEVELS</span> <span class="o">=</span> <span class="mi">6</span>


<div class="viewcode-block" id="FontConstantsBase"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.FontConstantsBase">[docs]</a><span class="k">class</span> <span class="nc">FontConstantsBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A set of constants that controls how certain things, such as sub-</span>
<span class="sd">    and superscripts are laid out.  These are all metrics that can't</span>
<span class="sd">    be reliably retrieved from the font metrics in the font itself.</span>
<span class="sd">    """</span>
    <span class="c1"># Percentage of x-height of additional horiz. space after sub/superscripts</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.05</span>

    <span class="c1"># Percentage of x-height that sub/superscripts drop below the baseline</span>
    <span class="n">subdrop</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="c1"># Percentage of x-height that superscripts are raised from the baseline</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.7</span>

    <span class="c1"># Percentage of x-height that subscripts drop below the baseline</span>
    <span class="n">sub1</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="c1"># Percentage of x-height that subscripts drop below the baseline when a</span>
    <span class="c1"># superscript is present</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="c1"># Percentage of x-height that sub/supercripts are offset relative to the</span>
    <span class="c1"># nucleus edge for non-slanted nuclei</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.025</span>

    <span class="c1"># Additional percentage of last character height above 2/3 of the</span>
    <span class="c1"># x-height that supercripts are offset relative to the subscript</span>
    <span class="c1"># for slanted nuclei</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="c1"># Percentage of x-height that supercripts and subscripts are offset for</span>
    <span class="c1"># integrals</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.1</span></div>


<div class="viewcode-block" id="ComputerModernFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.ComputerModernFontConstants">[docs]</a><span class="k">class</span> <span class="nc">ComputerModernFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.075</span>
    <span class="n">subdrop</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.45</span>
    <span class="n">sub1</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.075</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="STIXFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.STIXFontConstants">[docs]</a><span class="k">class</span> <span class="nc">STIXFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="STIXSansFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.STIXSansFontConstants">[docs]</a><span class="k">class</span> <span class="nc">STIXSansFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="DejaVuSerifFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSerifFontConstants">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSerifFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="DejaVuSansFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSansFontConstants">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSansFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># Maps font family names to the FontConstantBase subclass to use</span>
<span class="n">_font_constant_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'DejaVu Sans'</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">'DejaVu Sans Mono'</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">'DejaVu Serif'</span><span class="p">:</span> <span class="n">DejaVuSerifFontConstants</span><span class="p">,</span>
    <span class="s1">'cmb10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmex10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmmi10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmr10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmss10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmsy10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'cmtt10'</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXGeneral'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXNonUnicode'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXSizeFiveSym'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXSizeFourSym'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXSizeThreeSym'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXSizeTwoSym'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">'STIXSizeOneSym'</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="c1"># Map the fonts we used to ship, just for good measure</span>
    <span class="s1">'Bitstream Vera Sans'</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">'Bitstream Vera'</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">_get_font_constant_set</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="n">_font_constant_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">)</span><span class="o">.</span><span class="n">family_name</span><span class="p">,</span>
        <span class="n">FontConstantsBase</span><span class="p">)</span>
    <span class="c1"># STIX sans isn't really its own fonts, just different code points</span>
    <span class="c1"># in the STIX fonts, so we have to detect this one separately.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">constants</span> <span class="ow">is</span> <span class="n">STIXFontConstants</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="p">,</span> <span class="n">StixSansFonts</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">STIXSansFontConstants</span>
    <span class="k">return</span> <span class="n">constants</span>


<div class="viewcode-block" id="MathTextWarning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextWarning">[docs]</a><span class="k">class</span> <span class="nc">MathTextWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node">[docs]</a><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A node in the TeX box model</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__internal_repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__internal_repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

<div class="viewcode-block" id="Node.get_kerning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.get_kerning">[docs]</a>    <span class="k">def</span> <span class="nf">get_kerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="Node.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Shrinks one level smaller.  There are only three levels of</span>
<span class="sd">        sizes, after which things will no longer get smaller.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Node.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Grows one level larger.  There is no limit to how big</span>
<span class="sd">        something can get.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Node.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Box"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box">[docs]</a><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Represents any node with a physical location.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">=</span> <span class="n">depth</span>

<div class="viewcode-block" id="Box.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Box.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div>

<div class="viewcode-block" id="Box.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Vbox"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vbox">[docs]</a><span class="k">class</span> <span class="nc">Vbox</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A box with only height (zero width).</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hbox"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hbox">[docs]</a><span class="k">class</span> <span class="nc">Hbox</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A box with only width (zero height and depth).</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span></div>

<div class="viewcode-block" id="Char"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char">[docs]</a><span class="k">class</span> <span class="nc">Char</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Represents a single character.  Unlike TeX, the font information</span>
<span class="sd">    and metrics are stored with each :class:`Char` to make it easier</span>
<span class="sd">    to lookup the font metrics when needed.  Note that TeX boxes have</span>
<span class="sd">    a width, height, and depth, unlike Type1 and Truetype which use a</span>
<span class="sd">    full bounding box and an advance in the x-direction.  The metrics</span>
<span class="sd">    must be converted to the TeX way, and the advance (if different</span>
<span class="sd">    from width) must be converted into a :class:`Kern` node when the</span>
<span class="sd">    :class:`Char` is added to its parent :class:`Hlist`.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math</span> <span class="o">=</span> <span class="n">math</span>
        <span class="c1"># The real width, height and depth will be set during the</span>
        <span class="c1"># pack phase, after we know the real fontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__internal_repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'`</span><span class="si">%s</span><span class="s1">`'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_update_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s1">' '</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">advance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

<div class="viewcode-block" id="Char.is_slanted"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.is_slanted">[docs]</a>    <span class="k">def</span> <span class="nf">is_slanted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">slanted</span></div>

<div class="viewcode-block" id="Char.get_kerning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.get_kerning">[docs]</a>    <span class="k">def</span> <span class="nf">get_kerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return the amount of kerning between this and the given</span>
<span class="sd">        character.  Called when characters are strung together into</span>
<span class="sd">        :class:`Hlist` to create :class:`Kern` nodes.</span>
<span class="sd">        """</span>
        <span class="n">advance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="nb">next</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">advance</span> <span class="o">+</span> <span class="n">kern</span></div>

<div class="viewcode-block" id="Char.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Render the character to the canvas</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div>

<div class="viewcode-block" id="Char.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>    <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span>   <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>    <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Char.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>    <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span>   <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>    <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>

<div class="viewcode-block" id="Accent"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent">[docs]</a><span class="k">class</span> <span class="nc">Accent</span><span class="p">(</span><span class="n">Char</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The font metrics need to be dealt with differently for accents,</span>
<span class="sd">    since they are already offset correctly from the baseline in</span>
<span class="sd">    TrueType fonts.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">_update_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Accent.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Char</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span></div>

<div class="viewcode-block" id="Accent.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Char</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span></div>

<div class="viewcode-block" id="Accent.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Render the character to the canvas.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="List"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List">[docs]</a><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A list of nodes (either horizontal or vertical).</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># An arbitrary offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span>     <span class="o">=</span> <span class="n">elements</span> <span class="c1"># The child nodes of this list</span>
        <span class="c1"># The following parameters are set in the vpack and hpack functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># The glue setting of this list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span>    <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># 0: normal, -1: shrinking, 1: stretching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span>   <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># The order of infinity (0 - 3) for the glue</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'[</span><span class="si">%s</span><span class="s1"> &lt;</span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1">&gt; </span><span class="si">%s</span><span class="s1">]'</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__internal_repr__</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span><span class="p">,</span>
            <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_determine_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        A helper function to determine the highest order of glue</span>
<span class="sd">        used by the members of this list.  Used by vpack and hpack.</span>
<span class="sd">        """</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">totals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">_set_glue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">totals</span><span class="p">,</span> <span class="n">error_type</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_order</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="n">o</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="n">sign</span>
        <span class="k">if</span> <span class="n">totals</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">totals</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
                     <span class="n">MathTextWarning</span><span class="p">)</span>

<div class="viewcode-block" id="List.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">Box</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="List.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
        <span class="n">Box</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>

<div class="viewcode-block" id="Hlist"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist">[docs]</a><span class="k">class</span> <span class="nc">Hlist</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A horizontal list of boxes.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">'additional'</span><span class="p">,</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">List</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_kern</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kern</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpack</span><span class="p">()</span>

<div class="viewcode-block" id="Hlist.kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist.kern">[docs]</a>    <span class="k">def</span> <span class="nf">kern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Insert :class:`Kern` nodes between :class:`Char` nodes to set</span>
<span class="sd">        kerning.  The :class:`Char` nodes themselves determine the</span>
<span class="sd">        amount of kerning they need (in :meth:`~Char.get_kerning`),</span>
<span class="sd">        and this function just creates the linked list in the correct</span>
<span class="sd">        way.</span>
<span class="sd">        """</span>
        <span class="n">new_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_children</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_children</span><span class="p">):</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_children</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">next</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                <span class="n">kerning_distance</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_kerning</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kerning_distance</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">kern</span> <span class="o">=</span> <span class="n">Kern</span><span class="p">(</span><span class="n">kerning_distance</span><span class="p">)</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kern</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">new_children</span></div>

    <span class="c1"># This is a failed experiment to fake cross-font kerning.</span>
<span class="c1">#     def get_kerning(self, next):</span>
<span class="c1">#         if len(self.children) &gt;= 2 and isinstance(self.children[-2], Char):</span>
<span class="c1">#             if isinstance(next, Char):</span>
<span class="c1">#                 print "CASE A"</span>
<span class="c1">#                 return self.children[-2].get_kerning(next)</span>
<span class="c1">#             elif isinstance(next, Hlist) and len(next.children) and isinstance(next.children[0], Char):</span>
<span class="c1">#                 print "CASE B"</span>
<span class="c1">#                 result = self.children[-2].get_kerning(next.children[0])</span>
<span class="c1">#                 print result</span>
<span class="c1">#                 return result</span>
<span class="c1">#         return 0.0</span>

<div class="viewcode-block" id="Hlist.hpack"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist.hpack">[docs]</a>    <span class="k">def</span> <span class="nf">hpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">'additional'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        The main duty of :meth:`hpack` is to compute the dimensions of</span>
<span class="sd">        the resulting boxes, and to adjust the glue if one of those</span>
<span class="sd">        dimensions is pre-specified.  The computed sizes normally</span>
<span class="sd">        enclose all of the material inside the new box; but some items</span>
<span class="sd">        may stick out if negative glue is used, if the box is</span>
<span class="sd">        overfull, or if a ``\\vbox`` includes other boxes that have</span>
<span class="sd">        been shifted left.</span>

<span class="sd">          - *w*: specifies a width</span>

<span class="sd">          - *m*: is either 'exactly' or 'additional'.</span>

<span class="sd">        Thus, ``hpack(w, 'exactly')`` produces a box whose width is</span>
<span class="sd">        exactly *w*, while ``hpack(w, 'additional')`` yields a box</span>
<span class="sd">        whose width is the natural width plus *w*.  The default values</span>
<span class="sd">        produce a box with the natural width.</span>
<span class="sd">        """</span>
        <span class="c1"># I don't know why these get reset in TeX.  Shift_amount is pretty</span>
        <span class="c1"># much useless if we do.</span>
        <span class="c1">#self.shift_amount = 0.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">total_stretch</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">total_shrink</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">'shift_amount'</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span>
                <span class="n">total_stretch</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                <span class="n">total_shrink</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">'additional'</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_stretch</span><span class="p">,</span> <span class="s2">"Overfull"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_shrink</span><span class="p">,</span> <span class="s2">"Underfull"</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Vlist"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vlist">[docs]</a><span class="k">class</span> <span class="nc">Vlist</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A vertical list of boxes.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">'additional'</span><span class="p">):</span>
        <span class="n">List</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vpack</span><span class="p">()</span>

<div class="viewcode-block" id="Vlist.vpack"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vlist.vpack">[docs]</a>    <span class="k">def</span> <span class="nf">vpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">'additional'</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        The main duty of :meth:`vpack` is to compute the dimensions of</span>
<span class="sd">        the resulting boxes, and to adjust the glue if one of those</span>
<span class="sd">        dimensions is pre-specified.</span>

<span class="sd">          - *h*: specifies a height</span>
<span class="sd">          - *m*: is either 'exactly' or 'additional'.</span>
<span class="sd">          - *l*: a maximum height</span>

<span class="sd">        Thus, ``vpack(h, 'exactly')`` produces a box whose height is</span>
<span class="sd">        exactly *h*, while ``vpack(h, 'additional')`` yields a box</span>
<span class="sd">        whose height is the natural height plus *h*.  The default</span>
<span class="sd">        values produce a box with the natural width.</span>
<span class="sd">        """</span>
        <span class="c1"># I don't know why these get reset in TeX.  Shift_amount is pretty</span>
        <span class="c1"># much useless if we do.</span>
        <span class="c1"># self.shift_amount = 0.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">total_stretch</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">total_shrink</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">'shift_amount'</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span>
                <span class="n">total_stretch</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                <span class="n">total_shrink</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Internal mathtext error: Char node found in Vlist."</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">-</span> <span class="n">l</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">'additional'</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_stretch</span><span class="p">,</span> <span class="s2">"Overfull"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_shrink</span><span class="p">,</span> <span class="s2">"Underfull"</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Rule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Rule">[docs]</a><span class="k">class</span> <span class="nc">Rule</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A :class:`Rule` node stands for a solid black rectangle; it has</span>
<span class="sd">    *width*, *depth*, and *height* fields just as in an</span>
<span class="sd">    :class:`Hlist`. However, if any of these dimensions is inf, the</span>
<span class="sd">    actual value will be determined by running the rule up to the</span>
<span class="sd">    boundary of the innermost enclosing box. This is called a "running</span>
<span class="sd">    dimension." The width is never running in an :class:`Hlist`; the</span>
<span class="sd">    height and depth are never running in a :class:`Vlist`.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span>

<div class="viewcode-block" id="Rule.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Rule.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_rect_filled</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Hrule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hrule">[docs]</a><span class="k">class</span> <span class="nc">Hrule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Convenience class to create a horizontal rule.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">Rule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Vrule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vrule">[docs]</a><span class="k">class</span> <span class="nc">Vrule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Convenience class to create a vertical rule.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">Rule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glue"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue">[docs]</a><span class="k">class</span> <span class="nc">Glue</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Most of the information in this object is stored in the underlying</span>
<span class="sd">    :class:`GlueSpec` class, which is shared between multiple glue objects.  (This</span>
<span class="sd">    is a memory optimization which probably doesn't matter anymore, but it's</span>
<span class="sd">    easier to stick to what TeX does.)</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glue_type</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_subtype</span>   <span class="o">=</span> <span class="s1">'normal'</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue_type</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">GlueSpec</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">glue_type</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue_type</span><span class="p">,</span> <span class="n">GlueSpec</span><span class="p">):</span>
            <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">glue_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"glue_type must be a glue spec name or instance."</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span>      <span class="o">=</span> <span class="n">glue_spec</span>

<div class="viewcode-block" id="Glue.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Glue.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>

<div class="viewcode-block" id="GlueSpec"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec">[docs]</a><span class="k">class</span> <span class="nc">GlueSpec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    See :class:`Glue`.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stretch_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">shrink_order</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>         <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span>       <span class="o">=</span> <span class="n">stretch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">=</span> <span class="n">stretch_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span>        <span class="o">=</span> <span class="n">shrink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrink_order</span>  <span class="o">=</span> <span class="n">shrink_order</span>

<div class="viewcode-block" id="GlueSpec.copy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GlueSpec</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlueSpec.factory"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec.factory">[docs]</a>    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">glue_type</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_types</span><span class="p">[</span><span class="n">glue_type</span><span class="p">]</span></div>
    <span class="n">factory</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span></div>

<span class="n">GlueSpec</span><span class="o">.</span><span class="n">_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'fil'</span><span class="p">:</span>         <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">'fill'</span><span class="p">:</span>        <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">'filll'</span><span class="p">:</span>       <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">'neg_fil'</span><span class="p">:</span>     <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">'neg_fill'</span><span class="p">:</span>    <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s1">'neg_filll'</span><span class="p">:</span>   <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="s1">'empty'</span><span class="p">:</span>       <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">'ss'</span><span class="p">:</span>          <span class="n">GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Some convenient ways to get common kinds of glue</span>

<div class="viewcode-block" id="Fil"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fil">[docs]</a><span class="k">class</span> <span class="nc">Fil</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'fil'</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fill"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fill">[docs]</a><span class="k">class</span> <span class="nc">Fill</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'fill'</span><span class="p">)</span></div>

<div class="viewcode-block" id="Filll"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Filll">[docs]</a><span class="k">class</span> <span class="nc">Filll</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'filll'</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegFil"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFil">[docs]</a><span class="k">class</span> <span class="nc">NegFil</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'neg_fil'</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegFill"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFill">[docs]</a><span class="k">class</span> <span class="nc">NegFill</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'neg_fill'</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegFilll"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFilll">[docs]</a><span class="k">class</span> <span class="nc">NegFilll</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'neg_filll'</span><span class="p">)</span></div>

<div class="viewcode-block" id="SsGlue"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.SsGlue">[docs]</a><span class="k">class</span> <span class="nc">SsGlue</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'ss'</span><span class="p">)</span></div>

<div class="viewcode-block" id="HCentered"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.HCentered">[docs]</a><span class="k">class</span> <span class="nc">HCentered</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A convenience class to create an :class:`Hlist` whose contents are</span>
<span class="sd">    centered within its enclosing box.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">SsGlue</span><span class="p">()]</span> <span class="o">+</span> <span class="n">elements</span> <span class="o">+</span> <span class="p">[</span><span class="n">SsGlue</span><span class="p">()],</span>
                       <span class="n">do_kern</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="VCentered"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.VCentered">[docs]</a><span class="k">class</span> <span class="nc">VCentered</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A convenience class to create a :class:`Vlist` whose contents are</span>
<span class="sd">    centered within its enclosing box.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="n">Vlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">SsGlue</span><span class="p">()]</span> <span class="o">+</span> <span class="n">elements</span> <span class="o">+</span> <span class="p">[</span><span class="n">SsGlue</span><span class="p">()])</span></div>

<div class="viewcode-block" id="Kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern">[docs]</a><span class="k">class</span> <span class="nc">Kern</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A :class:`Kern` node has a width field to specify a (normally</span>
<span class="sd">    negative) amount of spacing. This spacing correction appears in</span>
<span class="sd">    horizontal lists between letters like A and V when the font</span>
<span class="sd">    designer said that it looks better to move them closer together or</span>
<span class="sd">    further apart. A kern node can also appear in a vertical list,</span>
<span class="sd">    when its *width* denotes additional spacing in the vertical</span>
<span class="sd">    direction.</span>
<span class="sd">    """</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"k</span><span class="si">%.02f</span><span class="s2">"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

<div class="viewcode-block" id="Kern.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Kern.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>

<div class="viewcode-block" id="SubSuperCluster"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.SubSuperCluster">[docs]</a><span class="k">class</span> <span class="nc">SubSuperCluster</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :class:`SubSuperCluster` is a sort of hack to get around that fact</span>
<span class="sd">    that this code do a two-pass parse like TeX.  This lets us store</span>
<span class="sd">    enough information in the hlist itself, namely the nucleus, sub-</span>
<span class="sd">    and super-script, such that if another script follows that needs</span>
<span class="sd">    to be attached, it can be reconfigured on the fly.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucleus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="AutoHeightChar"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.AutoHeightChar">[docs]</a><span class="k">class</span> <span class="nc">AutoHeightChar</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :class:`AutoHeightChar` will create a character as close to the</span>
<span class="sd">    given height and depth as possible.  When using a font with</span>
<span class="sd">    multiple height versions of some characters (such as the BaKoMa</span>
<span class="sd">    fonts), the correct glyph will be selected, otherwise this will</span>
<span class="sd">    always just return a scaled version of the glyph.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">xHeight</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">target_total</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">depth</span>
        <span class="k">for</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontname</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="c1"># Ensure that size 0 is chosen when the text is regular sized but</span>
            <span class="c1"># with descender glyphs by subtracting 0.2 * xHeight</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">target_total</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">xHeight</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_total</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>

        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">char</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span></div>

<div class="viewcode-block" id="AutoWidthChar"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.AutoWidthChar">[docs]</a><span class="k">class</span> <span class="nc">AutoWidthChar</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :class:`AutoWidthChar` will create a character as close to the</span>
<span class="sd">    given width as possible.  When using a font with multiple width</span>
<span class="sd">    versions of some characters (such as the BaKoMa fonts), the</span>
<span class="sd">    correct glyph will be selected, otherwise this will always just</span>
<span class="sd">    return a scaled version of the glyph.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">char_class</span><span class="o">=</span><span class="n">Char</span><span class="p">):</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontname</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char_class</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span>
        <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">char</span> <span class="o">=</span> <span class="n">char_class</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">char</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span></div>


<div class="viewcode-block" id="Ship"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship">[docs]</a><span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Once the boxes have been set up, this sends them to output.  Since</span>
<span class="sd">    boxes can be inside of boxes inside of boxes, the main work of</span>
<span class="sd">    :class:`Ship` is done by two mutually recursive routines,</span>
<span class="sd">    :meth:`hlist_out` and :meth:`vlist_out`, which traverse the</span>
<span class="sd">    :class:`Hlist` nodes and :class:`Vlist` nodes inside of horizontal</span>
<span class="sd">    and vertical boxes.  The global variables used in TeX to store</span>
<span class="sd">    state as it processes have become member variables here.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span>    <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Deepest nesting of push commands so far</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>       <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>       <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>       <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span>       <span class="o">=</span> <span class="n">ox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span>       <span class="o">=</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

<div class="viewcode-block" id="Ship.clamp"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.clamp">[docs]</a>    <span class="k">def</span> <span class="nf">clamp</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1000000000.</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">1000000000.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mf">1000000000.</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1000000000.</span>
        <span class="k">return</span> <span class="n">value</span></div>
    <span class="n">clamp</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">clamp</span><span class="p">)</span>

<div class="viewcode-block" id="Ship.hlist_out"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.hlist_out">[docs]</a>    <span class="k">def</span> <span class="nf">hlist_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="n">cur_g</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_glue</span>      <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">glue_order</span>    <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_order</span>
        <span class="n">glue_sign</span>     <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_sign</span>
        <span class="n">base_line</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
        <span class="n">left_edge</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>    <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span><span class="p">)</span>
        <span class="n">clamp</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="c1"># node623</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">shift_amount</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># p.vpack(box.height + box.depth, 'exactly')</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="c1"># node624</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">rule_depth</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="n">rule_width</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_height</span><span class="p">):</span>
                    <span class="n">rule_height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_depth</span><span class="p">):</span>
                    <span class="n">rule_depth</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">if</span> <span class="n">rule_height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rule_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span> <span class="o">+</span> <span class="n">rule_depth</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">,</span>
                             <span class="n">rule_width</span><span class="p">,</span> <span class="n">rule_height</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">rule_width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="c1"># node625</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">rule_width</span> <span class="o">=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">cur_g</span>
                <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># normal</span>
                    <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># stretching</span>
                        <span class="k">if</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                            <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                            <span class="n">cur_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span><span class="p">)</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                        <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
                        <span class="n">cur_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span><span class="p">)</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                <span class="n">rule_width</span> <span class="o">+=</span> <span class="n">cur_g</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">rule_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Ship.vlist_out"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.vlist_out">[docs]</a>    <span class="k">def</span> <span class="nf">vlist_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="n">cur_g</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_glue</span>      <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">glue_order</span>    <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_order</span>
        <span class="n">glue_sign</span>     <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_sign</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>    <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_push</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span><span class="p">)</span>
        <span class="n">left_edge</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>    <span class="o">-=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">top_edge</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
        <span class="n">clamp</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">left_edge</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">shift_amount</span>
                    <span class="n">save_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">save_v</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">left_edge</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">rule_depth</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="n">rule_width</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_width</span><span class="p">):</span>
                    <span class="n">rule_width</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
                <span class="n">rule_height</span> <span class="o">+=</span> <span class="n">rule_depth</span>
                <span class="k">if</span> <span class="n">rule_height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rule_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">rule_height</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">,</span>
                             <span class="n">rule_width</span><span class="p">,</span> <span class="n">rule_height</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">cur_g</span>
                <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># normal</span>
                    <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># stretching</span>
                        <span class="k">if</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                            <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                            <span class="n">cur_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span><span class="p">)</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span> <span class="c1"># shrinking</span>
                        <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
                        <span class="n">cur_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span><span class="p">)</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                <span class="n">rule_height</span> <span class="o">+=</span> <span class="n">cur_g</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">rule_height</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Internal mathtext error: Char node found in vlist"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span> <span class="o">-=</span> <span class="mi">1</span></div></div>


<span class="n">ship</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">()</span>

<span class="c1">##############################################################################</span>
<span class="c1"># PARSER</span>

<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Error">[docs]</a><span class="k">def</span> <span class="nf">Error</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Helper class to raise parser errors.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">raise_error</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="n">empty</span> <span class="o">=</span> <span class="n">Empty</span><span class="p">()</span>
    <span class="n">empty</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">empty</span></div>

<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This is the pyparsing-based parser for math expressions.  It</span>
<span class="sd">    actually parses full strings *containing* math expressions, in</span>
<span class="sd">    that raw text may also appear outside of pairs of ``$``.</span>

<span class="sd">    The grammar is based directly on that in TeX, though it cuts a few</span>
<span class="sd">    corners.</span>
<span class="sd">    """</span>

    <span class="n">_math_style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">displaystyle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">textstyle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">scriptstyle</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scriptscriptstyle</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">_binary_operators</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">'''</span>
<span class="s1">      + * -</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">pm             </span><span class="se">\\</span><span class="s1">sqcap                   </span><span class="se">\\</span><span class="s1">rhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">mp             </span><span class="se">\\</span><span class="s1">sqcup                   </span><span class="se">\\</span><span class="s1">unlhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">times          </span><span class="se">\\</span><span class="s1">vee                     </span><span class="se">\\</span><span class="s1">unrhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">div            </span><span class="se">\\</span><span class="s1">wedge                   </span><span class="se">\\</span><span class="s1">oplus</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">ast            </span><span class="se">\\</span><span class="s1">setminus                </span><span class="se">\\</span><span class="s1">ominus</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">star           </span><span class="se">\\</span><span class="s1">wr                      </span><span class="se">\\</span><span class="s1">otimes</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">circ           </span><span class="se">\\</span><span class="s1">diamond                 </span><span class="se">\\</span><span class="s1">oslash</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">bullet         </span><span class="se">\\</span><span class="s1">bigtriangleup           </span><span class="se">\\</span><span class="s1">odot</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cdot           </span><span class="se">\\</span><span class="s1">bigtriangledown         </span><span class="se">\\</span><span class="s1">bigcirc</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cap            </span><span class="se">\\</span><span class="s1">triangleleft            </span><span class="se">\\</span><span class="s1">dagger</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cup            </span><span class="se">\\</span><span class="s1">triangleright           </span><span class="se">\\</span><span class="s1">ddagger</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">uplus          </span><span class="se">\\</span><span class="s1">lhd                     </span><span class="se">\\</span><span class="s1">amalg'''</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_relation_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">'''</span>
<span class="s1">      = &lt; &gt; :</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leq            </span><span class="se">\\</span><span class="s1">geq             </span><span class="se">\\</span><span class="s1">equiv           </span><span class="se">\\</span><span class="s1">models</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">prec           </span><span class="se">\\</span><span class="s1">succ            </span><span class="se">\\</span><span class="s1">sim             </span><span class="se">\\</span><span class="s1">perp</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">preceq         </span><span class="se">\\</span><span class="s1">succeq          </span><span class="se">\\</span><span class="s1">simeq           </span><span class="se">\\</span><span class="s1">mid</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">ll             </span><span class="se">\\</span><span class="s1">gg              </span><span class="se">\\</span><span class="s1">asymp           </span><span class="se">\\</span><span class="s1">parallel</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">subset         </span><span class="se">\\</span><span class="s1">supset          </span><span class="se">\\</span><span class="s1">approx          </span><span class="se">\\</span><span class="s1">bowtie</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">subseteq       </span><span class="se">\\</span><span class="s1">supseteq        </span><span class="se">\\</span><span class="s1">cong            </span><span class="se">\\</span><span class="s1">Join</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">sqsubset       </span><span class="se">\\</span><span class="s1">sqsupset        </span><span class="se">\\</span><span class="s1">neq             </span><span class="se">\\</span><span class="s1">smile</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">sqsubseteq     </span><span class="se">\\</span><span class="s1">sqsupseteq      </span><span class="se">\\</span><span class="s1">doteq           </span><span class="se">\\</span><span class="s1">frown</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">in             </span><span class="se">\\</span><span class="s1">ni              </span><span class="se">\\</span><span class="s1">propto          </span><span class="se">\\</span><span class="s1">vdash</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">dashv          </span><span class="se">\\</span><span class="s1">dots            </span><span class="se">\\</span><span class="s1">dotplus         </span><span class="se">\\</span><span class="s1">doteqdot'''</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_arrow_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">'''</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftarrow              </span><span class="se">\\</span><span class="s1">longleftarrow           </span><span class="se">\\</span><span class="s1">uparrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Leftarrow              </span><span class="se">\\</span><span class="s1">Longleftarrow           </span><span class="se">\\</span><span class="s1">Uparrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">rightarrow             </span><span class="se">\\</span><span class="s1">longrightarrow          </span><span class="se">\\</span><span class="s1">downarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Rightarrow             </span><span class="se">\\</span><span class="s1">Longrightarrow          </span><span class="se">\\</span><span class="s1">Downarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftrightarrow         </span><span class="se">\\</span><span class="s1">longleftrightarrow      </span><span class="se">\\</span><span class="s1">updownarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Leftrightarrow         </span><span class="se">\\</span><span class="s1">Longleftrightarrow      </span><span class="se">\\</span><span class="s1">Updownarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">mapsto                 </span><span class="se">\\</span><span class="s1">longmapsto              </span><span class="se">\\</span><span class="s1">nearrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">hookleftarrow          </span><span class="se">\\</span><span class="s1">hookrightarrow          </span><span class="se">\\</span><span class="s1">searrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftharpoonup          </span><span class="se">\\</span><span class="s1">rightharpoonup          </span><span class="se">\\</span><span class="s1">swarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftharpoondown        </span><span class="se">\\</span><span class="s1">rightharpoondown        </span><span class="se">\\</span><span class="s1">nwarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">rightleftharpoons      </span><span class="se">\\</span><span class="s1">leadsto'''</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_spaced_symbols</span> <span class="o">=</span> <span class="n">_binary_operators</span> <span class="o">|</span> <span class="n">_relation_symbols</span> <span class="o">|</span> <span class="n">_arrow_symbols</span>

    <span class="n">_punctuation_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">', ; . ! \ldotp \cdotp'</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_overunder_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">'''</span>
<span class="s1">       \sum \prod \coprod \bigcap \bigcup \bigsqcup \bigvee</span>
<span class="s1">       \bigwedge \bigodot \bigotimes \bigoplus \biguplus</span>
<span class="s1">       '''</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_overunder_functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">"lim liminf limsup sup max min"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_dropsub_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">'''\int \oint'''</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_fontnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">"rm cal it tt sf bf default bb frak circled scr regular"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_function_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      arccos csc ker min arcsin deg lg Pr arctan det lim sec arg dim</span>
<span class="s2">      liminf sin cos exp limsup sinh cosh gcd ln sup cot hom log tan</span>
<span class="s2">      coth inf max tanh"""</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_ambi_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">      | </span><span class="se">\\</span><span class="s2">| / </span><span class="se">\\</span><span class="s2">backslash </span><span class="se">\\</span><span class="s2">uparrow </span><span class="se">\\</span><span class="s2">downarrow </span><span class="se">\\</span><span class="s2">updownarrow </span><span class="se">\\</span><span class="s2">Uparrow</span>
<span class="s2">      </span><span class="se">\\</span><span class="s2">Downarrow </span><span class="se">\\</span><span class="s2">Updownarrow . </span><span class="se">\\</span><span class="s2">vert </span><span class="se">\\</span><span class="s2">Vert </span><span class="se">\\\\</span><span class="s2">|"""</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_left_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">"( [ \{ &lt; \lfloor \langle \lceil"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_right_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">") ] \} &gt; \rfloor \rangle \rceil"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">()</span>
        <span class="c1"># All forward declarations are here</span>
        <span class="n">p</span><span class="o">.</span><span class="n">accent</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">binom</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">bslash</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">end_group</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span>    <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">font</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">frac</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">function</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span>          <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">group</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">latexfont</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbracket</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">main</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">math</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">math_string</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">non_math</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span>     <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">overline</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">required_group</span>   <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span>     <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span>    <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">snowflake</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">space</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start_group</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">token</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span>   <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

        <span class="c1"># Set names on everything -- very useful for debugging</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[-+]?([0-9]+\.?[0-9]*|\.[0-9]+)"</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span>   <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">"[-+]?[0-9]+"</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">'{'</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">'}'</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbracket</span>      <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">'['</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span>      <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">']'</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">bslash</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">space</span>         <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_space_widths</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>   <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\hspace'</span><span class="p">))</span>
                          <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                            <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \hspace</span><span class="si">{n}</span><span class="s2">"</span><span class="p">)))</span>

        <span class="n">unicode_range</span> <span class="o">=</span>  <span class="s2">"</span><span class="se">\U00000080</span><span class="s2">-</span><span class="se">\U0001ffff</span><span class="s2">"</span>
        <span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span> <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">"([a-zA-Z0-9 +\-*/&lt;&gt;=:,.;!\?&amp;'@()\[\]|</span><span class="si">%s</span><span class="s2">])|(</span><span class="se">\\</span><span class="s2">[</span><span class="si">%%</span><span class="s2">$</span><span class="si">{}</span><span class="s2">\[\]_|])"</span> <span class="o">%</span>
                               <span class="n">unicode_range</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">snowflake</span>     <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_snowflake</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span>   <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">Combine</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tex2uni</span><span class="p">)))</span> <span class="o">+</span>
                          <span class="n">FollowedBy</span><span class="p">(</span><span class="n">Regex</span><span class="p">(</span><span class="s2">"[^A-Za-z]"</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span> <span class="o">|</span> <span class="n">StringEnd</span><span class="p">()))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol</span>        <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span>

        <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>    <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">"'+"</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>      <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_char_over_chars</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">accent</span>        <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span>
                           <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_accent_map</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wide_accents</span><span class="p">))</span>
                           <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">function</span>      <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_function_names</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">start_group</span>   <span class="o">&lt;&lt;=</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">latexfont</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>
        <span class="n">p</span><span class="o">.</span><span class="n">end_group</span>     <span class="o">&lt;&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span>  <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">group</span>         <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">start_group</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">end_group</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">font</span>          <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontnames</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">latexfont</span>     <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">([</span><span class="s1">'math'</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontnames</span><span class="p">])</span>

        <span class="n">p</span><span class="o">.</span><span class="n">frac</span>          <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\frac"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \frac</span><span class="si">{num}{den}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>         <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\dfrac"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \dfrac</span><span class="si">{num}{den}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>      <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\stackrel"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \stackrel</span><span class="si">{num}{den}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">binom</span>         <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\binom"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \binom</span><span class="si">{num}{den}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ambi_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_left_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim</span>   <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_right_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span> <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_right_delim</span> <span class="o">-</span> <span class="p">{</span><span class="s1">'}'</span><span class="p">})</span> <span class="o">+</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'\}'</span><span class="p">])</span>

        <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span>       <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\genfrac"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">(((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                           <span class="o">+</span>   <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                           <span class="o">+</span>   <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                           <span class="o">+</span>   <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
                           <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Expected \genfrac</span><span class="si">{ldelim}{rdelim}{rulesize}{style}{num}{den}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span>          <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\sqrt"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbracket</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                              <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
                           <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Expected </span><span class="se">\\</span><span class="s2">sqrt</span><span class="si">{value}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">overline</span>      <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\overline"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Expected </span><span class="se">\\</span><span class="s2">overline</span><span class="si">{value}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span><span class="o">&lt;&lt;=</span> <span class="n">Combine</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span> <span class="o">+</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">"[A-Za-z]*"</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span>  <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\operatorname"</span><span class="p">))</span>
                           <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">simple</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                              <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Expected </span><span class="se">\\</span><span class="s2">operatorname</span><span class="si">{value}</span><span class="s2">"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>     <span class="o">&lt;&lt;=</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">snowflake</span> <span class="c1"># this needs to be before accent so named symbols</span>
                                          <span class="c1"># that are prefixed with an accent name work</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">accent</span> <span class="c1"># Must be before symbol as all accents are symbols</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="c1"># Must be third to catch all named symbols and single chars not in a group</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">function</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">group</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">frac</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">binom</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">overline</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">simple</span>        <span class="o">&lt;&lt;=</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">space</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">font</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">([</span><span class="s2">"_"</span><span class="p">,</span> <span class="s2">"^"</span><span class="p">])</span>

        <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>      <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
                             <span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">placeable</span><span class="p">)</span> <span class="o">+</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">placeable</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span><span class="p">))</span>
                           <span class="o">|</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">placeable</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span><span class="p">))</span>
                           <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">token</span>         <span class="o">&lt;&lt;=</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">simple</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>
                         <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span> <span class="c1"># Must be last</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>    <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\left"</span><span class="p">))</span>
                          <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">left_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Expected a delimiter"</span><span class="p">))</span>
                          <span class="o">+</span> <span class="n">Group</span><span class="p">(</span><span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">simple</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span><span class="p">))</span>
                          <span class="o">+</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\right"</span><span class="p">))</span>
                          <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">right_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span><span class="p">)</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Expected a delimiter"</span><span class="p">))</span>
                         <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">math</span>          <span class="o">&lt;&lt;=</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">math_string</span>   <span class="o">&lt;&lt;=</span> <span class="n">QuotedString</span><span class="p">(</span><span class="s1">'$'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span> <span class="n">unquoteResults</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">non_math</span>      <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(?:(?:</span><span class="se">\\</span><span class="s2">[$])|[^$])*"</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span>

        <span class="n">p</span><span class="o">.</span><span class="n">main</span>          <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">non_math</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">math_string</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">non_math</span><span class="p">))</span> <span class="o">+</span> <span class="n">StringEnd</span><span class="p">()</span>

        <span class="c1"># Set actions</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_math_expression</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">math</span>

<div class="viewcode-block" id="Parser.parse"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">fonts_object</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Parse expression *s* using the given *fonts_object* for</span>
<span class="sd">        output, at the given *fontsize* and *dpi*.</span>

<span class="sd">        Returns the parse tree of :class:`Node` instances.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">fonts_object</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">,</span> <span class="s1">'rm'</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ParseBaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="s2">""</span><span class="p">,</span>
                        <span class="n">err</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                        <span class="s2">" "</span> <span class="o">*</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"^"</span><span class="p">,</span>
                        <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">err</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="o">.</span><span class="n">resetCache</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="c1"># The state of the parser is maintained in a stack.  Upon</span>
    <span class="c1"># entering and leaving a group { } or math/non-math, the stack</span>
    <span class="c1"># is pushed and popped accordingly.  The current state always</span>
    <span class="c1"># exists in the top element of the stack.</span>
<div class="viewcode-block" id="Parser.State"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.State">[docs]</a>    <span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Stores the state of the parser.</span>

<span class="sd">        States are pushed and popped from a stack as necessary, and</span>
<span class="sd">        the "current" state is always at the top of the stack.</span>
<span class="sd">        """</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font_output</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">font_output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">font_class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>

<div class="viewcode-block" id="Parser.State.copy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.State.copy">[docs]</a>        <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Parser</span><span class="o">.</span><span class="n">State</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div>

        <span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>
        <span class="k">def</span> <span class="nf">_set_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'rm'</span><span class="p">,</span> <span class="s1">'it'</span><span class="p">,</span> <span class="s1">'bf'</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">font</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_font</span><span class="p">,</span> <span class="n">_set_font</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.get_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the current :class:`State` of the parser.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.pop_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.pop_state">[docs]</a>    <span class="k">def</span> <span class="nf">pop_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Pop a :class:`State` off of the stack.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.push_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.push_state">[docs]</a>    <span class="k">def</span> <span class="nf">push_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Push a new :class:`State` onto the stack which is just a copy</span>
<span class="sd">        of the current state.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>

<div class="viewcode-block" id="Parser.main"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Parser.math_string"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.math_string">[docs]</a>    <span class="k">def</span> <span class="nf">math_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_math_expression</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="Parser.math"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.math">[docs]</a>    <span class="k">def</span> <span class="nf">math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.non_math"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.non_math">[docs]</a>    <span class="k">def</span> <span class="nf">non_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\$'</span><span class="p">,</span> <span class="s1">'$'</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span> <span class="n">math</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="c1"># We're going into math now, so set font to 'it'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.default'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_make_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentage</span><span class="p">):</span>
        <span class="c1"># All spaces are relative to em width</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.default'</span><span class="p">],</span> <span class="s1">'m'</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
        <span class="k">return</span> <span class="n">Kern</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">percentage</span><span class="p">)</span>

    <span class="n">_space_widths</span> <span class="o">=</span> <span class="p">{</span> <span class="sa">r</span><span class="s1">'\,'</span>         <span class="p">:</span> <span class="mf">0.16667</span><span class="p">,</span>  <span class="c1"># 3/18 em = 3 mu</span>
                      <span class="sa">r</span><span class="s1">'\thinspace'</span> <span class="p">:</span> <span class="mf">0.16667</span><span class="p">,</span>  <span class="c1"># 3/18 em = 3 mu</span>
                      <span class="sa">r</span><span class="s1">'\/'</span>         <span class="p">:</span> <span class="mf">0.16667</span><span class="p">,</span>  <span class="c1"># 3/18 em = 3 mu</span>
                      <span class="sa">r</span><span class="s1">'\&gt;'</span>         <span class="p">:</span> <span class="mf">0.22222</span><span class="p">,</span>  <span class="c1"># 4/18 em = 4 mu</span>
                      <span class="sa">r</span><span class="s1">'\:'</span>         <span class="p">:</span> <span class="mf">0.22222</span><span class="p">,</span>  <span class="c1"># 4/18 em = 4 mu</span>
                      <span class="sa">r</span><span class="s1">'\;'</span>         <span class="p">:</span> <span class="mf">0.27778</span><span class="p">,</span>  <span class="c1"># 5/18 em = 5 mu</span>
                      <span class="sa">r</span><span class="s1">'\ '</span>         <span class="p">:</span> <span class="mf">0.33333</span><span class="p">,</span>  <span class="c1"># 6/18 em = 6 mu</span>
                      <span class="sa">r</span><span class="s1">'\enspace'</span>   <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>      <span class="c1"># 9/18 em = 9 mu</span>
                      <span class="sa">r</span><span class="s1">'\quad'</span>      <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>        <span class="c1"># 1 em = 18 mu</span>
                      <span class="sa">r</span><span class="s1">'\qquad'</span>     <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>        <span class="c1"># 2 em = 36 mu</span>
                      <span class="sa">r</span><span class="s1">'\!'</span>         <span class="p">:</span> <span class="o">-</span><span class="mf">0.16667</span><span class="p">,</span> <span class="c1"># -3/18 em = -3 mu</span>
                      <span class="p">}</span>
<div class="viewcode-block" id="Parser.space"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.space">[docs]</a>    <span class="k">def</span> <span class="nf">space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_widths</span><span class="p">[</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">box</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.customspace"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.customspace">[docs]</a>    <span class="k">def</span> <span class="nf">customspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span></div>

<div class="viewcode-block" id="Parser.symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.symbol">[docs]</a>    <span class="k">def</span> <span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="s2">"Unknown symbol: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spaced_symbols</span><span class="p">:</span>
            <span class="c1"># iterate until we find previous character, needed for cases</span>
            <span class="c1"># such as ${ -2}$, $ -2$, or $   -2$.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">prev_char</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">prev_char</span> <span class="o">!=</span> <span class="s1">' '</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="c1"># Binary operators at start of string should not be spaced</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_operators</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">loc</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">prev_char</span> <span class="o">==</span> <span class="s1">'{'</span> <span class="ow">or</span>
                        <span class="n">prev_char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_delim</span><span class="p">)):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
                               <span class="n">char</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)]</span> <span class="p">,</span>
                               <span class="n">do_kern</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_punctuation_symbols</span><span class="p">:</span>

            <span class="c1"># Do not space commas between brackets</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">','</span><span class="p">:</span>
                <span class="n">prev_char</span><span class="p">,</span> <span class="n">next_char</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">prev_char</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">prev_char</span> <span class="o">!=</span> <span class="s1">' '</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">loc</span><span class="p">):</span>
                    <span class="n">next_char</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">next_char</span> <span class="o">!=</span> <span class="s1">' '</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">prev_char</span> <span class="o">==</span> <span class="s1">'{'</span> <span class="ow">and</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s1">'}'</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>

            <span class="c1"># Do not space dots as decimal separators</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">'.'</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="n">char</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)],</span>
                               <span class="n">do_kern</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span></div>

    <span class="n">snowflake</span> <span class="o">=</span> <span class="n">symbol</span>

<div class="viewcode-block" id="Parser.unknown_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.unknown_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">unknown_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="s2">"Unknown symbol: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span></div>

    <span class="n">_char_over_chars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># The first 2 entries in the tuple are (font, char, sizescale) for</span>
        <span class="c1"># the two symbols under and over.  The third element is the space</span>
        <span class="c1"># (in multiples of underline height)</span>
        <span class="sa">r</span><span class="s1">'AA'</span><span class="p">:</span> <span class="p">((</span><span class="s1">'it'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">circ'</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Parser.c_over_c"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.c_over_c">[docs]</a>    <span class="k">def</span> <span class="nf">c_over_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">under_desc</span><span class="p">,</span> <span class="n">over_desc</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_char_over_chars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">under_desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">"Error parsing symbol"</span><span class="p">)</span>

        <span class="n">over_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">over_state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">over_state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">over</span> <span class="o">=</span> <span class="n">Accent</span><span class="p">(</span><span class="n">over_desc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">over_state</span><span class="p">)</span>

        <span class="n">under_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">under_state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">under_state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">under</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">under_desc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">under_state</span><span class="p">)</span>

        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">over</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">under</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="n">over_centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">over</span><span class="p">])</span>
        <span class="n">over_centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>

        <span class="n">under_centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">under</span><span class="p">])</span>
        <span class="n">under_centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Vlist</span><span class="p">([</span>
                <span class="n">over_centered</span><span class="p">,</span>
                <span class="n">Vbox</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="n">space</span><span class="p">),</span>
                <span class="n">under_centered</span>
                <span class="p">])</span></div>

    <span class="n">_accent_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">r</span><span class="s1">'hat'</span>   <span class="p">:</span> <span class="sa">r</span><span class="s1">'\circumflexaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'breve'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningbreve'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'bar'</span>   <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningoverline'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'grave'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combininggraveaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'acute'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningacuteaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'tilde'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningtilde'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'dot'</span>   <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningdotabove'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'ddot'</span>  <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningdiaeresis'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'vec'</span>   <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningrightarrowabove'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'"'</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningdiaeresis'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">"`"</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combininggraveaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">"'"</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningacuteaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'~'</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningtilde'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'.'</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\combiningdotabove'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'^'</span>     <span class="p">:</span> <span class="sa">r</span><span class="s1">'\circumflexaccent'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'overrightarrow'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\rightarrow'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'overleftarrow'</span>  <span class="p">:</span> <span class="sa">r</span><span class="s1">'\leftarrow'</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">'mathring'</span> <span class="p">:</span> <span class="sa">r</span><span class="s1">'\circ'</span>
        <span class="p">}</span>

    <span class="n">_wide_accents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">"widehat widetilde widebar"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="c1"># make a lambda and call it to get the namespace right</span>
    <span class="n">_snowflake</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">am</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tex2uni</span> <span class="k">if</span>
                              <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">am</span><span class="p">)]</span>
                  <span class="p">)</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_accent_map</span><span class="p">))</span>

<div class="viewcode-block" id="Parser.accent"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.accent">[docs]</a>    <span class="k">def</span> <span class="nf">accent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">"Error parsing accent"</span><span class="p">)</span>
        <span class="n">accent</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">accent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wide_accents</span><span class="p">:</span>
            <span class="n">accent_box</span> <span class="o">=</span> <span class="n">AutoWidthChar</span><span class="p">(</span>
                <span class="s1">'</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">accent</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">char_class</span><span class="o">=</span><span class="n">Accent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accent_box</span> <span class="o">=</span> <span class="n">Accent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_accent_map</span><span class="p">[</span><span class="n">accent</span><span class="p">],</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">accent</span> <span class="o">==</span> <span class="s1">'mathring'</span><span class="p">:</span>
            <span class="n">accent_box</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">accent_box</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">Hbox</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">),</span> <span class="n">accent_box</span><span class="p">])</span>
        <span class="n">centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vlist</span><span class="p">([</span>
                <span class="n">centered</span><span class="p">,</span>
                <span class="n">Vbox</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>
                <span class="n">Hlist</span><span class="p">([</span><span class="n">sym</span><span class="p">])</span>
                <span class="p">])</span></div>

<div class="viewcode-block" id="Parser.function"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">'rm'</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="n">hlist</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hlist</span></div>

<div class="viewcode-block" id="Parser.operatorname"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.operatorname">[docs]</a>    <span class="k">def</span> <span class="nf">operatorname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">'rm'</span>
        <span class="c1"># Change the font of Chars, but leave Kerns alone</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">'rm'</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Parser.start_group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.start_group">[docs]</a>    <span class="k">def</span> <span class="nf">start_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="c1"># Deal with LaTeX-style font tokens</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.group">[docs]</a>    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">grp</span><span class="p">]</span></div>
    <span class="n">required_group</span> <span class="o">=</span> <span class="n">simple_group</span> <span class="o">=</span> <span class="n">group</span>

<div class="viewcode-block" id="Parser.end_group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.end_group">[docs]</a>    <span class="k">def</span> <span class="nf">end_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.font"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.font">[docs]</a>    <span class="k">def</span> <span class="nf">font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.is_overunder"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_overunder">[docs]</a>    <span class="k">def</span> <span class="nf">is_overunder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overunder_symbols</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="s1">'function_name'</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">function_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overunder_functions</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_dropsub"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_dropsub">[docs]</a>    <span class="k">def</span> <span class="nf">is_dropsub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dropsub_symbols</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_slanted"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_slanted">[docs]</a>    <span class="k">def</span> <span class="nf">is_slanted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">is_slanted</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_between_brackets"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_between_brackets">[docs]</a>    <span class="k">def</span> <span class="nf">is_between_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.subsuper"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.subsuper">[docs]</a>    <span class="k">def</span> <span class="nf">subsuper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>

        <span class="n">nucleus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Pick all of the apostrophes out, including first apostrophes that have</span>
        <span class="c1"># been parsed as characters</span>
        <span class="n">napostrophes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_toks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tok</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'^'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">):</span>
                <span class="n">napostrophes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">Char</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tok</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s2">"'"</span><span class="p">:</span>
                <span class="n">napostrophes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_toks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">new_toks</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">napostrophes</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">napostrophes</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># .asList()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="c1"># single subscript or superscript</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">op</span><span class="p">,</span> <span class="nb">next</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">'_'</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="nb">next</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="nb">next</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="c1"># subscript and superscript</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="k">else</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">op1</span><span class="p">,</span> <span class="n">next1</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">next2</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="n">op2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="s1">'_'</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">"Double subscript"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">"Double superscript"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="s1">'_'</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">next1</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">next2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">next1</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">next2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span>
                <span class="s2">"Subscript/superscript sequence is too long. "</span>
                <span class="s2">"Use braces { } to remove ambiguity."</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">rule_thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">xHeight</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">napostrophes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">napostrophes</span><span class="p">):</span>
                <span class="nb">super</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="p">[</span><span class="s1">'</span><span class="se">\\</span><span class="s1">prime'</span><span class="p">]))</span>
            <span class="c1"># kern() and hpack() needed to get the metrics right after extending</span>
            <span class="nb">super</span><span class="o">.</span><span class="n">kern</span><span class="p">()</span>
            <span class="nb">super</span><span class="o">.</span><span class="n">hpack</span><span class="p">()</span>

        <span class="c1"># Handle over/under symbols, such as sum or integral</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_overunder</span><span class="p">(</span><span class="n">nucleus</span><span class="p">):</span>
            <span class="n">vlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">super</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">super</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sub</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="nb">super</span><span class="p">])</span>
                <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
                <span class="n">vlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hlist</span><span class="p">,</span> <span class="n">Kern</span><span class="p">(</span><span class="n">rule_thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">)])</span>
            <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">nucleus</span><span class="p">])</span>
            <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
            <span class="n">vlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlist</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">sub</span><span class="p">])</span>
                <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
                <span class="n">vlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">rule_thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">),</span> <span class="n">hlist</span><span class="p">])</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">hlist</span><span class="o">.</span><span class="n">height</span>
            <span class="n">vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">(</span><span class="n">vlist</span><span class="p">)</span>
            <span class="n">vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">depth</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">vlist</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>

        <span class="c1"># We remove kerning on the last character for consistency (otherwise it</span>
        <span class="c1"># will compute kerning based on non-shrinked characters and may put them</span>
        <span class="c1"># too close together when superscripted)</span>
        <span class="c1"># We change the width of the last character to match the advance to</span>
        <span class="c1"># consider some fonts with weird metrics: e.g. stix's f has a width of</span>
        <span class="c1"># 7.75 and a kerning of -4.0 for an advance of 3.72, and we want to put</span>
        <span class="c1"># the superscript at the advance</span>
        <span class="n">last_char</span> <span class="o">=</span> <span class="n">nucleus</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
            <span class="n">new_children</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">children</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_children</span><span class="p">):</span>
                <span class="c1"># remove last kern</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">Kern</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s1">'_metrics'</span><span class="p">)):</span>
                    <span class="n">new_children</span> <span class="o">=</span> <span class="n">new_children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_char</span> <span class="o">=</span> <span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">last_char</span><span class="p">,</span> <span class="s1">'_metrics'</span><span class="p">):</span>
                    <span class="n">last_char</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="c1"># create new Hlist without kerning</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">new_children</span><span class="p">,</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">last_char</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">nucleus</span><span class="p">])</span>

        <span class="c1"># Handle regular sub/superscripts</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="n">_get_font_constant_set</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">lc_height</span>   <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">height</span>
        <span class="n">lc_baseline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">lc_baseline</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">depth</span>

        <span class="c1"># Compute kerning for sub and super</span>
        <span class="n">superkern</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="n">subkern</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_slanted</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">superkern</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="n">superkern</span> <span class="o">+=</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">delta_slanted</span> <span class="o">*</span>
                          <span class="p">(</span><span class="n">lc_height</span> <span class="o">-</span> <span class="n">xHeight</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">subkern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span>
                           <span class="n">constants</span><span class="o">.</span><span class="n">delta_integral</span><span class="p">)</span> <span class="o">*</span> <span class="n">lc_height</span>
                <span class="n">superkern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">+</span>
                             <span class="n">constants</span><span class="o">.</span><span class="n">delta_integral</span><span class="p">)</span> <span class="o">*</span> <span class="n">lc_height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subkern</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># node757</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">subkern</span><span class="p">),</span> <span class="n">sub</span><span class="p">])</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">shift_down</span> <span class="o">=</span> <span class="n">lc_baseline</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_down</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sub1</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift_down</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">superkern</span><span class="p">),</span> <span class="nb">super</span><span class="p">])</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">shift_up</span> <span class="o">=</span> <span class="n">lc_height</span> <span class="o">-</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_up</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sup1</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">shift_up</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Both sub and superscript</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">subkern</span><span class="p">),</span><span class="n">sub</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                    <span class="n">shift_down</span> <span class="o">=</span> <span class="n">lc_baseline</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shift_down</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sub2</span> <span class="o">*</span> <span class="n">xHeight</span>
                <span class="c1"># If sub and superscript collide, move super up</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rule_thickness</span> <span class="o">-</span>
                       <span class="p">((</span><span class="n">shift_up</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">shift_down</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">clr</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">shift_up</span> <span class="o">+=</span> <span class="n">clr</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">x</span><span class="p">,</span>
                           <span class="n">Kern</span><span class="p">((</span><span class="n">shift_up</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">shift_down</span><span class="p">)),</span>
                           <span class="n">y</span><span class="p">])</span>
                <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift_down</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">script_space</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_genfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ldelim</span><span class="p">,</span> <span class="n">rdelim</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="c1"># If style != displaystyle == 0, shrink the num and den</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">'displaystyle'</span><span class="p">]:</span>
            <span class="n">num</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">den</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">cnum</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">num</span><span class="p">])</span>
        <span class="n">cden</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">den</span><span class="p">])</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">den</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">cnum</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
        <span class="n">cden</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">'exactly'</span><span class="p">)</span>
        <span class="n">vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">cnum</span><span class="p">,</span>                      <span class="c1"># numerator</span>
                       <span class="n">Vbox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># space</span>
                       <span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">),</span>        <span class="c1"># rule</span>
                       <span class="n">Vbox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># space</span>
                       <span class="n">cden</span>                       <span class="c1"># denominator</span>
                       <span class="p">])</span>

        <span class="c1"># Shift so the fraction line sits in the middle of the</span>
        <span class="c1"># equals sign</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.default'</span><span class="p">],</span>
            <span class="s1">'='</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">cden</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span>
                 <span class="p">((</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span>
                  <span class="n">thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">))</span>
        <span class="n">vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="n">vlist</span><span class="p">,</span> <span class="n">Hbox</span><span class="p">(</span><span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">)])]</span>
        <span class="k">if</span> <span class="n">ldelim</span> <span class="ow">or</span> <span class="n">rdelim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ldelim</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
                <span class="n">ldelim</span> <span class="o">=</span> <span class="s1">'.'</span>
            <span class="k">if</span> <span class="n">rdelim</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
                <span class="n">rdelim</span> <span class="o">=</span> <span class="s1">'.'</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_sized_delimiter</span><span class="p">(</span><span class="n">ldelim</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">rdelim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Parser.genfrac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.genfrac">[docs]</a>    <span class="k">def</span> <span class="nf">genfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Parser.frac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.frac">[docs]</a>    <span class="k">def</span> <span class="nf">frac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">'textstyle'</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dfrac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.dfrac">[docs]</a>    <span class="k">def</span> <span class="nf">dfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">'displaystyle'</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.stackrel"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.stackrel">[docs]</a>    <span class="k">def</span> <span class="nf">stackrel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">'textstyle'</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.binom"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.binom">[docs]</a>    <span class="k">def</span> <span class="nf">binom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">'('</span><span class="p">,</span> <span class="s1">')'</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">'textstyle'</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.sqrt"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.sqrt">[docs]</a>    <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># Determine the height of the body, and add a little extra to</span>
        <span class="c1"># the height so it doesn't seem cramped</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">+</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">5.0</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">AutoHeightChar</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\__sqrt__'</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">check</span><span class="o">.</span><span class="n">shift_amount</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">check</span><span class="o">.</span><span class="n">shift_amount</span>

        <span class="c1"># Put a little extra space to the left and right of the body</span>
        <span class="n">padded_body</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Hbox</span><span class="p">(</span><span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>
                             <span class="n">body</span><span class="p">,</span>
                             <span class="n">Hbox</span><span class="p">(</span><span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)])</span>
        <span class="n">rightside</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">),</span>
                           <span class="n">Fill</span><span class="p">(),</span>
                           <span class="n">padded_body</span><span class="p">])</span>
        <span class="c1"># Stretch the glue between the hrule and the body</span>
        <span class="n">rightside</span><span class="o">.</span><span class="n">vpack</span><span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="mf">12.0</span><span class="p">),</span>
                        <span class="s1">'exactly'</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="c1"># Add the root and shift it upward so it is above the tick.</span>
        <span class="c1"># The value of 0.6 is a hard-coded hack ;)</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Char</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root</span><span class="p">])</span>
            <span class="n">root</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">root</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>

        <span class="n">root_vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hlist</span><span class="p">([</span><span class="n">root</span><span class="p">])])</span>
        <span class="n">root_vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.6</span>

        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">root_vlist</span><span class="p">,</span>               <span class="c1"># Root</span>
                       <span class="c1"># Negative kerning to put root over tick</span>
                       <span class="n">Kern</span><span class="p">(</span><span class="o">-</span><span class="n">check</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>
                       <span class="n">check</span><span class="p">,</span>                    <span class="c1"># Check</span>
                       <span class="n">rightside</span><span class="p">])</span>               <span class="c1"># Body</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.overline"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.overline">[docs]</a>    <span class="k">def</span> <span class="nf">overline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span>

        <span class="n">body</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">+</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">3.0</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span>

        <span class="c1"># Place overline above body</span>
        <span class="n">rightside</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">),</span>
                           <span class="n">Fill</span><span class="p">(),</span>
                           <span class="n">Hlist</span><span class="p">([</span><span class="n">body</span><span class="p">])])</span>

        <span class="c1"># Stretch the glue between the hrule and the body</span>
        <span class="n">rightside</span><span class="o">.</span><span class="n">vpack</span><span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="mf">12.0</span><span class="p">),</span>
                        <span class="s1">'exactly'</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">rightside</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_auto_sized_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">back</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">middle</span><span class="p">):</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle</span><span class="p">)</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">depth</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># \left. and \right. aren't supposed to produce any symbols</span>
        <span class="k">if</span> <span class="n">front</span> <span class="o">!=</span> <span class="s1">'.'</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AutoHeightChar</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">))</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span> <span class="o">!=</span> <span class="s1">'.'</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AutoHeightChar</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">))</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hlist</span>

<div class="viewcode-block" id="Parser.auto_delim"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.auto_delim">[docs]</a>    <span class="k">def</span> <span class="nf">auto_delim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">back</span> <span class="o">=</span> <span class="n">toks</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_sized_delimiter</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="o">.</span><span class="n">asList</span><span class="p">(),</span> <span class="n">back</span><span class="p">)</span></div></div>

<span class="c1">###</span>

<span class="c1">##############################################################################</span>
<span class="c1"># MAIN</span>

<div class="viewcode-block" id="MathTextParser"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser">[docs]</a><span class="k">class</span> <span class="nc">MathTextParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_parser</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_backend_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'bitmap'</span><span class="p">:</span> <span class="n">MathtextBackendBitmap</span><span class="p">,</span>
        <span class="s1">'agg'</span>   <span class="p">:</span> <span class="n">MathtextBackendAgg</span><span class="p">,</span>
        <span class="s1">'ps'</span>    <span class="p">:</span> <span class="n">MathtextBackendPs</span><span class="p">,</span>
        <span class="s1">'pdf'</span>   <span class="p">:</span> <span class="n">MathtextBackendPdf</span><span class="p">,</span>
        <span class="s1">'svg'</span>   <span class="p">:</span> <span class="n">MathtextBackendSvg</span><span class="p">,</span>
        <span class="s1">'path'</span>  <span class="p">:</span> <span class="n">MathtextBackendPath</span><span class="p">,</span>
        <span class="s1">'cairo'</span> <span class="p">:</span> <span class="n">MathtextBackendCairo</span><span class="p">,</span>
        <span class="s1">'macosx'</span><span class="p">:</span> <span class="n">MathtextBackendAgg</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">_font_type_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'cm'</span>          <span class="p">:</span> <span class="n">BakomaFonts</span><span class="p">,</span>
        <span class="s1">'dejavuserif'</span> <span class="p">:</span> <span class="n">DejaVuSerifFonts</span><span class="p">,</span>
        <span class="s1">'dejavusans'</span>  <span class="p">:</span> <span class="n">DejaVuSansFonts</span><span class="p">,</span>
        <span class="s1">'stix'</span>        <span class="p">:</span> <span class="n">StixFonts</span><span class="p">,</span>
        <span class="s1">'stixsans'</span>    <span class="p">:</span> <span class="n">StixSansFonts</span><span class="p">,</span>
        <span class="s1">'custom'</span>      <span class="p">:</span> <span class="n">UnicodeFonts</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Create a MathTextParser for the given backend *output*.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">maxdict</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<div class="viewcode-block" id="MathTextParser.parse"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">72</span><span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Parse the given math expression *s* at the given *dpi*.  If</span>
<span class="sd">        *prop* is provided, it is a</span>
<span class="sd">        :class:`~matplotlib.font_manager.FontProperties` object</span>
<span class="sd">        specifying the "default" font to use in the math expression,</span>
<span class="sd">        used for all non-math text.</span>

<span class="sd">        The results are cached, so multiple calls to :meth:`parse`</span>
<span class="sd">        with the same expression should be fast.</span>
<span class="sd">        """</span>
        <span class="c1"># There is a bug in Python 3.x where it leaks frame references,</span>
        <span class="c1"># and therefore can't handle this caching</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">()</span>

        <span class="n">cacheKey</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="nb">hash</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">==</span> <span class="s1">'ps'</span> <span class="ow">and</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'ps.useafm'</span><span class="p">]:</span>
            <span class="n">font_output</span> <span class="o">=</span> <span class="n">StandardPsFonts</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">]()</span>
            <span class="n">fontset</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">'mathtext.fontset'</span><span class="p">]</span>
            <span class="n">fontset_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_type_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fontset</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">fontset_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">font_output</span> <span class="o">=</span> <span class="n">fontset_class</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"mathtext.fontset must be either 'cm', 'dejavuserif', "</span>
                    <span class="s2">"'dejavusans', 'stix', 'stixsans', or 'custom'"</span><span class="p">)</span>

        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">()</span>

        <span class="c1"># This is a class variable so we don't rebuild the parser</span>
        <span class="c1"># with each request.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">font_output</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">font_output</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">font_output</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">cacheKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MathTextParser.to_mask"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_mask">[docs]</a>    <span class="k">def</span> <span class="nf">to_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        *texstr*</span>
<span class="sd">            A valid mathtext string, e.g., r'IQ: $\\sigma_i=15$'</span>

<span class="sd">        *dpi*</span>
<span class="sd">            The dots-per-inch to render the text</span>

<span class="sd">        *fontsize*</span>
<span class="sd">            The font size in points</span>

<span class="sd">        Returns a tuple (*array*, *depth*)</span>

<span class="sd">          - *array* is an NxM uint8 alpha ubyte mask array of</span>
<span class="sd">            rasterized tex.</span>

<span class="sd">          - depth is the offset of the baseline from the bottom of the</span>
<span class="sd">            image in pixels.</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">==</span> <span class="s2">"bitmap"</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ftimage</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">ftimage</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.to_rgba"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_rgba">[docs]</a>    <span class="k">def</span> <span class="nf">to_rgba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        *texstr*</span>
<span class="sd">            A valid mathtext string, e.g., r'IQ: $\\sigma_i=15$'</span>

<span class="sd">        *color*</span>
<span class="sd">            Any matplotlib color argument</span>

<span class="sd">        *dpi*</span>
<span class="sd">            The dots-per-inch to render the text</span>

<span class="sd">        *fontsize*</span>
<span class="sd">            The font size in points</span>

<span class="sd">        Returns a tuple (*array*, *depth*)</span>

<span class="sd">          - *array* is an NxM uint8 alpha ubyte mask array of</span>
<span class="sd">            rasterized tex.</span>

<span class="sd">          - depth is the offset of the baseline from the bottom of the</span>
<span class="sd">            image in pixels.</span>
<span class="sd">        """</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mask</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">RGBA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">r</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">g</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">b</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">RGBA</span><span class="p">,</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.to_png"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_png">[docs]</a>    <span class="k">def</span> <span class="nf">to_png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Writes a tex expression to a PNG file.</span>

<span class="sd">        Returns the offset of the baseline from the bottom of the</span>
<span class="sd">        image in pixels.</span>

<span class="sd">        *filename*</span>
<span class="sd">            A writable filename or fileobject</span>

<span class="sd">        *texstr*</span>
<span class="sd">            A valid mathtext string, e.g., r'IQ: $\\sigma_i=15$'</span>

<span class="sd">        *color*</span>
<span class="sd">            A valid matplotlib color argument</span>

<span class="sd">        *dpi*</span>
<span class="sd">            The dots-per-inch to render the text</span>

<span class="sd">        *fontsize*</span>
<span class="sd">            The font size in points</span>

<span class="sd">        Returns the offset of the baseline from the bottom of the</span>
<span class="sd">        image in pixels.</span>
<span class="sd">        """</span>
        <span class="n">rgba</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">_png</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">rgba</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.get_depth"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.get_depth">[docs]</a>    <span class="k">def</span> <span class="nf">get_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the offset of the baseline from the bottom of the</span>
<span class="sd">        image in pixels.</span>

<span class="sd">        *texstr*</span>
<span class="sd">            A valid mathtext string, e.g., r'IQ: $\\sigma_i=15$'</span>

<span class="sd">        *dpi*</span>
<span class="sd">            The dots-per-inch to render the text</span>

<span class="sd">        *fontsize*</span>
<span class="sd">            The font size in points</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">==</span><span class="s2">"bitmap"</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ftimage</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depth</span></div></div>

<div class="viewcode-block" id="math_to_image"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.math_to_image">[docs]</a><span class="k">def</span> <span class="nf">math_to_image</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">filename_or_obj</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Given a math expression, renders it in a closely-clipped bounding</span>
<span class="sd">    box to an image file.</span>

<span class="sd">    *s*</span>
<span class="sd">       A math expression.  The math portion should be enclosed in</span>
<span class="sd">       dollar signs.</span>

<span class="sd">    *filename_or_obj*</span>
<span class="sd">       A filepath or writable file-like object to write the image data</span>
<span class="sd">       to.</span>

<span class="sd">    *prop*</span>
<span class="sd">       If provided, a FontProperties() object describing the size and</span>
<span class="sd">       style of the text.</span>

<span class="sd">    *dpi*</span>
<span class="sd">       Override the output dpi, otherwise use the default associated</span>
<span class="sd">       with the output format.</span>

<span class="sd">    *format*</span>
<span class="sd">       The output format, e.g., 'svg', 'pdf', 'ps' or 'png'.  If not</span>
<span class="sd">       provided, will be deduced from the filename.</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">figure</span>
    <span class="c1"># backend_agg supports all of the core output formats</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="k">import</span> <span class="n">backend_agg</span>

    <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">()</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">MathTextParser</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mf">72.0</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">72.0</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="o">/</span><span class="n">height</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">backend_agg</span><span class="o">.</span><span class="n">FigureCanvasAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">depth</span></div>
</pre></div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div class="footer">
        © Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2018 The Matplotlib development team.
        <br/>
      Last updated on Jun 28, 2018.
	Created using
	<ahref>Sphinx 1.7.5.
	Doc version v2.2.2-101-g15e1eadd0.
    </ahref></div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55954603-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
<footer>
<!--Flipcause Integration v3.0// Flipcause Integration Instructions:
Install the following code block once in the website Header (after <head> tag) -->
<style>

.fc-black_overlay{
display:none; position: fixed; z-index:1000001; top: 0%;left: 0%;width: 100%;height: 100%;
background-color: black; filter: alpha(opacity=50); cursor:pointer; opacity:0.5;
}

.fc-white_content {
opacity:1; display:none; margin-top: -320px; margin-left: -485px; width:970px; height:640px;
position:fixed; top:50%; left:50%; border: none;z-index:1000002;overflow: auto;
}

.fc-main-box{
opacity:1; display:none; margin:15px auto 0 auto; width:930px; position:relative; z-index:1000003;
}

.fc-widget_close{
opacity:1; content:url(http://i1338.photobucket.com/albums/o691/WeCause/X_zpse4a7e538.png);
position:absolute; z-index=1000004; right:-16px; top:-16px; display:block; cursor:pointer;
}

.floating_button{
display: block; margin-top: 0px; margin-left: 0px; width:auto ; height: auto;
position:fixed; z-index:999999; overflow: auto;
}

@keyframes backfadesin {
   from { opacity:0; }
   to {opacity:.5;}
}

@-moz-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-webkit-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@-o-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}


@-ms-keyframes backfadesin {
    from { opacity:0; }
    to {opacity:.5;}
}

@keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; transform: translateY(20px);}
   100% {opacity: 1; transform: translateY(0);}
}

@-moz-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -moz-transform: translateY(20px);}
   100% {opacity: 1; -moz-transform: translateY(0);}
}

@-webkit-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -webkit-transform: translateY(20px);}
   100% {opacity: 1; -webkit-transform: translateY(0);}
}

@-o-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -o-transform: translateY(20px);}
   100% {opacity: 1; -o-transform: translateY(0);}
}

@-ms-keyframes fadesin {
   0%{ opacity:0; }
   50%{ opacity:0; }
   75% {opacity: 0; -ms-transform: translateY(20px);}
   100% {opacity: 1; -ms-transform: translateY(0);}
}

</style>
<div class="fc-black_overlay" id="fc-fade" onclick="close_window()"></div>
<div class="fc-white_content" id="fc-light">
<div class="fc-main-box" id="fc-main">
<div class="fc-widget_close" id="fc-close" onclick="close_window()">
</div><iframe height="580" id="fc-myFrame" iframe="" scrolling="no" src="" style="border: 0;
border-radius:5px 5px 5px 5px; box-shadow:0 0 8px rgba(0, 0, 0, 0.5);" width="925"></iframe></div>
</div>
<!--END Flipcause Main Integration Code-->
</footer>
</html>